<html><head lang="ja"><link rel="icon" type="image/png" href="favicon.png"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/><meta property="og:type" content="article"/><meta property="og:image" content="https://hinaser.github.io/Machine-Learning/preview.png"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image" content="https://hinaser.github.io/Machine-Learning/preview.png"/><meta name="twitter:image:width" content="1200"/><meta name="twitter:image:height" content="630"/><meta name="author" content="Hinase"/><meta name="keywords" content="Deep Learning, Neural Network, TensorFlow, Machine Learning"/><meta property="og:title" content="TensorFlowのインストール"/><meta property="og:description" content="TensorFlowを使ってディープラーニングを試す"/><meta property="og:url" content="https://hinaser.github.io/Machine-Learning/deeplearning-by-tensorflow.html"/><meta name="twitter:title" content="TensorFlowのインストール"/><meta name="twitter:description" content="TensorFlowを使ってディープラーニングを試す"/><meta name="twitter:url" content="https://hinaser.github.io/Machine-Learning/deeplearning-by-tensorflow.html"/><title>TensorFlowのインストール</title><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/><link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css"/><script defer="" src="https://code.getmdl.io/1.3.0/material.min.js"></script><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/><link href="https://fonts.googleapis.com/earlyaccess/notosansjapanese.css" rel="stylesheet"/><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link rel="stylesheet" href="css/lib.css" type="text/css" data-turbolinks-track="reload"/><link rel="stylesheet" href="css/main.css?ac36d58eca" type="text/css" data-turbolinks-track="reload"/><script id="st_insights_js" type="text/javascript" src="https://ws.sharethis.com/button/buttons.js?publisher=8fde68e6-f234-4808-b7ab-c498ac41fe48"></script><script type="text/javascript">stLight.options({
    publisher: "8fde68e6-f234-4808-b7ab-c498ac41fe48",
    doNotHash: true,
    doNotCopy: true,
    hashAddressBar: false
});</script><script src="js/lib.js?6099111fed" data-turbolinks-track="reload"></script></head><body><div class="dpln-layout top-header-left-nav-layout fixed-top"><header class="dpln-layout-header"><i class="material-icons" id="toggle-nav">view_headline</i><span class="site-title">機械学習、ディープラーニング</span></header><nav class="dpln-layout-nav"><figure class="collapsible" data-page="learntensorflowplayground"><figcaption><span class="menu-title">TensorFlow Playgroundの仕組み</span><button class="mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">keyboard_arrow_down</i></button></figcaption><ul><li><a href="index.html#preface-part">はじめに</a></li><li><a href="index.html#reference-part">参考文献</a></li><li><a href="index.html#summary-part">Playgroundの仕組み</a></li><li><a href="index.html#learningsettings-part">ニューラルネットワークについて</a></li><li><a href="index.html#about-learning-in-nn-part">ニューラルネットワークの学習に関する設定</a></li><li><a href="index.html#learningrate-part">学習率</a></li><li><a href="index.html#activator-part">活性化関数</a></li><li><a href="index.html#regularization-part">正則化、正則化項</a></li><li><a href="index.html#problemtype-part">統計モデルの種類</a></li><li><a href="index.html#inputdata-part">データに関する設定</a></li><li><a href="index.html#dataselection-part">どのデータセットを使うか</a></li><li><a href="index.html#ratio-of-training-data-part">トレーニングデータの割合</a></li><li><a href="index.html#noise-part">ノイズ</a></li><li><a href="index.html#batchsize-part">バッチサイズ</a></li><li><a href="index.html#feature-part">入力するデータの特徴と隠し層</a></li><li><a href="index.html#backpropagation-part">バックプロパゲーション(誤差逆伝搬法)</a></li></ul></figure><figure class="collapsible" data-page="deeplearning-by-tensorflow"><figcaption><span class="menu-title">TensorFlowでディープラーニング</span><button class="mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">keyboard_arrow_down</i></button></figcaption><div class="dpln-expand"></div><ul><li><a href="deeplearning-by-tensorflow.html">TensorFlowのインストール</a></li><li><a href="deeplearning-by-tensorflow-with-gpu.html">TensorFlowのインストール(GPU利用編)</a></li></ul></figure><figure class="collapsible" data-page="math-for-ml"><figcaption><span class="menu-title">機械学習のための数学</span><button class="mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">keyboard_arrow_down</i></button></figcaption><ul><li><a href="math-for-ml.html#cross-entropy">クロスエントロピー</a></li></ul></figure><figure class="collapsible" data-page="[&quot;profile&quot;, &quot;reference&quot;, &quot;useful-tools-and-services&quot;]"><figcaption><span class="menu-title">その他</span><button class="mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">keyboard_arrow_down</i></button></figcaption><ul><li><a href="profile.html">著者プロフィール</a></li><li><a href="reference.html">参考サイト集</a></li><li><a href="useful-tools-and-services.html">お世話になっているツール/サービス</a></li></ul></figure></nav><main class="dpln-layout-main"><article class="main-article" data-page="deeplearning-by-tensorflow"><a class="in-page-anchor" id="preface-part"></a><h1>TensorFlowのインストール</h1><div class="article-metadata"><div id="post-date"><i class="material-icons md-24">timer</i><span>2017-03-02</span></div><div id="author"><i class="material-icons md-24">person</i><span>Hinase</span></div><span class="author-external-profile"><a class="header-logo-invertocat" href="https://github.com/Hinaser" aria-label="Github Profile"><svg class="octicon octicon-mark-github" aria-hidden="true" height="24" version="1.1" viewbox="0 0 16 16" width="24" fill="rgba(0, 0, 0, 0.7)"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg></a><a class="header-logo-twitter" href="https://twitter.com/h1nase" target="_blank" style="line-height: 30px; display: inline-block; vertical-align: middle; margin-left: 10px; margin-right: 10px;"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 400 400" height="24"><defs><style>.cls-1 {
  fill: #1da1f2;
}

.cls-2 {
  fill: #fff;
}

.cls-3 {
  fill: none;
}</style></defs><title>Twitter_Logo_White-on-Blue</title><g id="Dark_Blue" data-name="Dark Blue"><rect class="cls-1" width="400" height="400"></rect></g><g id="Logo_FIXED" data-name="Logo — FIXED"><path class="cls-2" d="M153.62 301.59c94.34 0 145.94-78.16 145.94-145.94 0-2.22 0-4.43-.15-6.63A104.36 104.36 0 0 0 325 122.47a102.38 102.38 0 0 1-29.46 8.07 51.47 51.47 0 0 0 22.55-28.37 102.79 102.79 0 0 1-32.57 12.45 51.34 51.34 0 0 0-87.41 46.78A145.62 145.62 0 0 1 92.4 107.81a51.33 51.33 0 0 0 15.88 68.47A50.91 50.91 0 0 1 85 169.86c0 .21 0 .43 0 .65a51.31 51.31 0 0 0 41.15 50.28 51.21 51.21 0 0 1-23.16.88 51.35 51.35 0 0 0 47.92 35.62 102.92 102.92 0 0 1-63.7 22A104.41 104.41 0 0 1 75 278.55a145.21 145.21 0 0 0 78.62 23"></path><rect class="cls-3" width="400" height="400"></rect></g></svg></a></span><span class="social-share"><span class="st_facebook_hcount" displaytext="Facebook"></span><span class="st_twitter_hcount" displaytext="Tweet"></span><span class="st_googleplus_hcount" displaytext="Google +"></span></span></div><img class="tensorflow-logo" src="image/deeplearning-by-tensorflow/tf_logo_transp.png" alt=""/><div class="paragraph"><h4>TensorFlowとは</h4><p><a href="https://www.tensorflow.org/#about-tensorflow" target="_blank">TensorFlow</a>はGoogleの開発したオープンソースの数値計算ソフトウェアライブラリです。
”機械学習のための”、という枕詞がつかないのは、機械学習に限定されない様々な用途で利用できるためです。<br/>TensorFlowは他の多くの科学数値計算ライブラリと同様に<a href="https://www.python.org/" target="_blank">Python</a>上で動作します。(Python以外の言語で利用できないわけではありません。詳細は<a href="https://www.tensorflow.org/extend/language_bindings" target="_blank">こちら</a>。)</p><p>私も現在のところTensorFlowを勉強中なので、説明ができるレベルで理解ができ次第この項目に文章を追加していこうと思います。</p></div><div class="paragraph"><a class="in-page-anchor" id="install-tensorflow"></a><h4>TensorFlowのインストール</h4><p>TensorFlowのインストール方法は<a href="https://www.tensorflow.org/install/" target="_blank">オフィシャルサイト</a>で詳しく説明されています。
ちなみにTensorFlowは現在はWindowsにネイティブで(仮想環境を介さずに)インストールできるようになりましたが、<a href="https://developers.googleblog.com/2016/11/tensorflow-0-12-adds-support-for-windows.html" target="_blank">2016年11月までWindowsネイティブでの動作がサポート対象外だったこともあり</a>、 Ubuntu Linuxでの実行をおすすめします。
私はUbuntu Linux OS上でTensorFlowを実行しています。</p><p>一点、私の環境では上記オフィシャル手順ではスムーズにインストールが完了しませんでした。</p><p>私と同じ環境でTensorFlowを実行したい方は、私の環境、および実施したインストール手順を下記に記載しますので参考にしてください。</p><table class="install-environment"><tr><td>OS</td><td>Ubuntu 16.04 64bit</td><td><a href="https://www.ubuntu.com/download/desktop" target="_blank">Ubuntu Desktop</a></td></tr><tr><td>Python</td><td>3.5.2</td><td><code>sudo apt-get install python3</code></td></tr><tr><td>TensorFlow</td><td>r1.0</td><td><a href="https://github.com/tensorflow/tensorflow/tree/r1.0" target="_blank">https://github.com/tensorflow/tensorflow/tree/r1.0</a></td></tr></table><p>私の環境ではTensorFlowをソースインストールしています。
理由は、ソースからのインストール以外の方法でTensorFlowをインストールすると、私の環境では下記のようなワーニングが毎回コンソールに出力されてしまうためです。</p><code>W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE3 instructions, but these are available on your machine and could speed up CPU computations.
W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.1 instructions, but these are available on your machine and could speed up CPU computations.
W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use SSE4.2 instructions, but these are available on your machine and could speed up CPU computations.
W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX instructions, but these are available on your machine and could speed up CPU computations.
W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use AVX2 instructions, but these are available on your machine and could speed up CPU computations.
W tensorflow/core/platform/cpu_feature_guard.cc:45] The TensorFlow library wasn't compiled to use FMA instructions, but these are available on your machine and could speed up CPU computations.</code><p>メッセージは、SSE3やAVXなどの<a href="https://ja.wikipedia.org/wiki/Streaming_SIMD_Extensions" target="_blank">拡張命令セット</a>が利用できる環境であるにもかかわらず、これらの拡張命令を使用するようにTensorFlowがビルドされていないと言っているようです。
プリコンパイル済みTensorFlowをインストールすると毎回このワーニングがコンソールに出力されてしまいます。</p><h5>インストール手順</h5><p>Ubuntu 16.04/Python3.5/GPUサポート無し/ソースインストール/virtualenv利用 の構成でのインストール手順を紹介します。<br/>ちなみにこの手順は2017/3/2に検証した手順であり、将来同じ手順で正しくTensorFlowをインストールできない可能性があります。</p><h6>Bazelのインストール</h6><p>参考URL:<a href="https://bazel.build/versions/master/docs/install.html" target="_blank">https://bazel.build/versions/master/docs/install.html</a></p><p>BazelはGoogle製のビルドツールです。TensorFlowをソースからビルドする際に必要になります。<br/>bazelがJDK1.9に対応していないため、JDK1.9がOSにインストールされていると上記手順途中でエラーが発生します。
私は下記のようにしてJava9/JDK1.9をアンインストールしました。<br/><small>* 利用している他のソフトウェアがJava1.9を利用している場合はそのソフトウェアが動作しなくなる可能性があります。
コマンドの意味や影響がわからなければ実行しないでください。</small></p><div class="code"><div class="code-line">$&nbsp;<span class="user-input">sudo apt-get purge openjdk-9* java-9*</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div></div><p>次にJDK1.8をインストールします。</p><div class="code"><div class="code-line">$&nbsp;<span class="user-input">sudo apt-get install openjdk-8-j*</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line">$&nbsp;<span class="user-input">java -version</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line no-copy">&nbsp;&nbsp;# openjdk version "1.8.x_xxx" と表示されることを確認。</div></div><p>Bazelの配布用URIとパッケージソースの追加</p><div class="code"><div class="code-line">$&nbsp;<span class="user-input">echo &quot;deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8&quot; | sudo tee /etc/apt/sources.list.d/bazel.list</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line">$&nbsp;<span class="user-input">curl https://bazel.build/bazel-release.pub.gpg | sudo apt-key add -</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div></div><p>Bazelのインストール</p><div class="code"><div class="code-line">$&nbsp;<span class="user-input">sudo apt-get update &amp;&amp; sudo apt-get install bazel</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div></div><h6>PythonのVirtualenv環境のセットアップ</h6><p>TensorFlow専用のPython実行環境を作成します。Virtualenvを使うとプロジェクト専用のPythonバージョン、Pythonソフトウェアパッケージ
を構築できるようになります。Virtualenv環境を切り替えるとPythonのバージョンや利用できるパッケージも自由に切り替えられるようになります。</p><p>pip3をインストールします。</p><div class="code"><div class="code-line">$&nbsp;<span class="user-input">sudo apt-get install python3-pip</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div></div><p>virtualenvをインストールします。</p><div class="code"><div class="code-line">$&nbsp;<span class="user-input">sudo apt-get install python-virtualenv</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div></div><p>TensorFlow用のvirtualenv環境を作成し、環境を有効にします。下記のコマンドを実行すると/home/&lt;ユーザ名&gt; ディレクトリ直下に
新たにtensorflowというディレクトリを作成します。</p><div class="code"><div class="code-line">$&nbsp;<span class="user-input">virtualenv -p python3 --system-site-packages ~/tensorflow</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line">$&nbsp;<span class="user-input">source ~/tensorflow/bin/activate</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div></div><p>環境が有効になっていればプロンプトが下記のように変化しているはずです。</p><div class="code"><div class="code-line no-copy">(tensorflow)$</div></div><p>この状態でpip installを実行すると、このvirtualenv環境にのみpipパッケージがインストールされます。</p><div class="indent"><p>※ちなみに環境を抜けたい場合は下記を実行すればOKです。</p><div class="code"><div class="code-line">(tensorflow)$&nbsp;<span class="user-input">deactivate</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div></div></div><p>次にTensorFlowで必要なパッケージをvirtualenv環境にインストールします。</p><div class="code"><div class="code-line">(tensorflow)$&nbsp;<span class="user-input">pip install six numpy wheel</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div></div><h5>TensorFlowのソースをダウンロード/ビルド構成を設定する。</h5><p>まずはGithubのTensorFlowのレポジトリからソースコードをダウンロードします。</p><div class="code"><div class="code-line">(tensorflow)$&nbsp;<span class="user-input">mkdir -p ~/projects</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line">(tensorflow)$&nbsp;<span class="user-input">cd ~/projects</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line">(tensorflow)$&nbsp;<span class="user-input">git clone https://github.com/tensorflow/tensorflow</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line">(tensorflow)$&nbsp;<span class="user-input">cd tensorflow</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line">(tensorflow)$&nbsp;<span class="user-input">git checkout r1.0</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div></div><p>ソースのビルド構成を設定します。全てそのままEnterを押してデフォルトの設定を使います。</p><div class="code"><div class="code-line">(tensorflow)$&nbsp;<span class="user-input">./configure</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line no-copy">Please specify the location of python. [Default is /home/ユーザ名/tensorflow/bin/python]:</div>Please specify optimization flags to use during compilation [Default is -march=native]:<div class="code-line no-copy">Do you wish to use jemalloc as the malloc implementation? (Linux only) [Y/n]</div><div class="code-line no-copy">Do you wish to build TensorFlow with Google Cloud Platform support? [y/N]</div><div class="code-line no-copy">Do you wish to build TensorFlow with Hadoop File System support? [y/N]</div><div class="code-line no-copy">Do you wish to build TensorFlow with the XLA just-in-time compiler (experimental)? [y/N]</div><div class="code-line no-copy">Please input the desired Python library path to use.  Default is [/home/ユーザ名/tensorflow/lib/python3.5/site-packages]</div><div class="code-line no-copy">Do you wish to build TensorFlow with OpenCL support? [y/N]</div><div class="code-line no-copy">Do you wish to build TensorFlow with CUDA support? [y/N]</div></div><div class="indent"><p>ちなみに私の環境ではここで下記のようなエラーが出力されてしまいました。</p><code>ERROR: /home/ユーザ名/projects/tensorflow/tensorflow/python/BUILD:2275:1: every rule of type _py_wrap_cc implicitly depends upon the target '@swig//:templates', but this target could not be found because of: no such package '@swig//': Error downloading [http://bazel-mirror.storage.googleapis.com/ufpr.dl.sourceforge.net/project/swig/swig/swig-3.0.8/swig-3.0.8.tar.gz, http://ufpr.dl.sourceforge.net/project/swig/swig/swig-3.0.8/swig-3.0.8.tar.gz, http://pilotfiber.dl.sourceforge.net/project/swig/swig/swig-3.0.8/swig-3.0.8.tar.gz] to /home/ユーザ名/.cache/bazel/_bazel_ユーザ名/3f6df72b6e217920e9a8b0ddfd37c24d/external/swig/swig-3.0.8.tar.gz: All mirrors are down: [].
ERROR: Evaluation of query "deps((//tensorflow/... - //tensorflow/examples/android/...))" failed: errors were encountered while computing transitive closure.</code><p>私が確認した限りでは、tensorflowの外部依存パッケージ'swig'のダウンロードタイムアウトが原因のエラーのようです。<br/>curlコマンドで上記エラー内の"bazel-mirror.storage.googleapis.com"と"pilotfiber.dl.sourceforge.net"および"pilotfiber.dl.sourceforge.net"
に対してswig-3.0.8.tar.gzのダウンロードを試してみたところ、"bazel-mirror.storage.googleapis.com"以外の2つのミラーサイトの反応が遅いことがわかりました。
(数秒待てばダウンロード自体は始まります)。
おそらくbazelはパッケージのダウンロードに対するレスポンスタイムアウトの閾値が厳しく設定されており、
パッケージの配信サーバがもたつくとサーバがダウンしていると判断してしまうようです。</p><p>この問題を解決するため、 tensorflow/tensorflow/workspace.bzl ファイルを下記のように修正し、
レスポンスが遅い２つのサーバをダウンロードリストから外して再度<code class="code">./configure</code>コマンドを実行したところ、無事エラーなくコマンドが完了しました。</p><div class="code file-edit">native.new_http_archive(
&nbsp;&nbsp;&nbsp;&nbsp;name = "swig",
&nbsp;&nbsp;&nbsp;&nbsp;sha256 = "58a475dbbd4a4d7075e5fe86d4e54c9edde39847cdb96a3053d87cb64a23a453",
&nbsp;&nbsp;&nbsp;&nbsp;urls = [
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"http://bazel-mirror.storage.googleapis.com/ufpr.dl.sourceforge.net/project/swig/swig/swig-3.0.8/swig-3.0.8.tar.gz",<br/><span class="strike-through">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"http://ufpr.dl.sourceforge.net/project/swig/swig/swig-3.0.8/swig-3.0.8.tar.gz",</span>&nbsp;←この行を削除<br/><span class="strike-through">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"http://pilotfiber.dl.sourceforge.net/project/swig/swig/swig-3.0.8/swig-3.0.8.tar.gz",</span>&nbsp;←この行を削除<br/>&nbsp;&nbsp;&nbsp;&nbsp;],
&nbsp;&nbsp;&nbsp;&nbsp;strip_prefix = "swig-3.0.8",
&nbsp;&nbsp;&nbsp;&nbsp;build_file = str(Label("//third_party:swig.BUILD")),
)</div><p>同じようなエラーが発生した方は上記の方法を試してみてください。<code class="code">./configure</code>コマンドの実行が完了したあとは、ソースコードを<code class="code">git reset --hard</code>で戻しておきましょう。</p></div><h5>TensorFlowのソースをビルドする。</h5><p>bazel buildでソースをビルドします。<br/>ちなみに私のマシン(CPU: i5-4570S@2.9GHz, 4core, RAM: 8GB)では23分かかりました。
CPU使用率もほとんどの時間で4コアとも使用率100%、メモリも見ていた限り最大で8GBの99.7%、スワップも3.5GB使用していました。
他の作業と同時並行でビルドするのはやめたほうが良いです。他のアプリを閉じたうえでビルドしましょう。</p><div class="code"><div class="code-line">(tensorflow)$<span class="user-input">bazel build -c opt --copt=-mavx --copt=-mavx2 --copt=-mfma --copt=-mfpmath=both --copt=-msse4.2 //tensorflow/tools/pip_package:build_pip_package</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div></div><p>上記のコマンドが完了すると、bazel-bin/tensorflow/tools/pip_package/build_pip_packageというファイルが作成されます。
そのファイル名の通り、TensorFlowのpipパッケージを作成するツールです。</p><div class="indent"><p>※上記のコマンドはAVX/AVX2/FMA/SSE4.2の拡張命令セットが使えるCPUでのみ有効です。(ビルドは成功しますがプログラム実行時にエラーが発生します。)<br/>私の持っているCPU(Intel Core i7 2600K)ではAVX2とFMAはサポートされてなかったため、AVX2/FMAに関するオプションを削除した上で実行しました。</p><div class="code"><div class="code-line">(tensorflow)$&nbsp;<span class="user-input">bazel build -c opt --copt=-mavx --copt=-mfpmath=both --copt=-msse4.2 --config=cuda //tensorflow/tools/pip_package:build_pip_package</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div></div></div><h5>TensorFlowのpipパッケージを作成し、インストールする。</h5><p>カスタムビルドしたTensorFlowをpipパッケージ化します。
下記のコマンドを実行すると、/tmp/tensorflow_pkgディレクトリ直下にpipパッケージファイル(~.whl)を生成します。
このコマンドは先程までとは違い、20秒ほどで完了します。</p><div class="code"><div class="code-line">(tensorflow)$&nbsp;<span class="user-input">bazel-bin/tensorflow/tools/pip_package/build_pip_package /tmp/tensorflow_pkg</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div></div><p>生成された.whlファイルでpipインストールします。</p><div class="code"><div class="code-line">(tensorflow)$&nbsp;<span class="user-input">pip install $(ls /tmp/tensorflow_pkg/*.whl)</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line no-copy">...</div><div class="code-line no-copy">Successfully installed protobuf-3.2.0 tensorflow-1.0.0</div></div><p>これでTensorFlowのソースインストールは完了です。</p><h5>インストールの検証</h5><p>TensorFlowが正しくインストールされたか確認します。</p><div class="code"><div class="code-line no-copy"># tensorflowのプロジェクトディレクトリにいるままだとエラーがでるのでディレクトリを出ます。</div><div class="code-line">(tensorflow)$&nbsp;<span class="user-input">cd ../</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line">(tensorflow)$&nbsp;<span class="user-input">python</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line">>>>&nbsp;<span class="user-input">import tensorflow as tf</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line">>>>&nbsp;<span class="user-input">hello = tf.constant('Hello world')</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line">>>>&nbsp;<span class="user-input">sess = tf.Session()</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line">>>>&nbsp;<span class="user-input">print(sess.run(hello))</span><div class="clipboard"><i class="fa fa-clipboard" aria-hidden="true"></i></div></div><div class="code-line no-copy"># b'Hello world' と表示されればOKです。</div></div></div><div id="disqus_thread"></div><script>var disqus_config = function () {
    this.page.url = document.location.href;
    this.page.identifier = document.location.pathname;
};
(function () { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://hinaser-github-io-machine-learning.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script></article></main></div><script src="js/main.js?0c38373d66" data-turbolinks-track="reload"></script><script src="js/raw/analytics.js" data-turbolinks-track="reload"></script></body></html>