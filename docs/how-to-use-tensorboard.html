<html><head lang="ja"><link rel="icon" type="image/png" href="favicon.png"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/><meta property="og:type" content="article"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:image:width" content="1200"/><meta name="twitter:image:height" content="630"/><meta name="author" content="Hinase"/><meta name="keywords" content="TensorBoard, Deep Learning, Neural Network, TensorFlow, Machine Learning, CUDA, nVidia"/><meta property="og:title" content="TensorBoardの使い方"/><meta property="og:description" content="TensorBoardの使い方を具体例とともに解説します。"/><meta property="og:url" content="https://hinaser.github.io/Machine-Learning/how-to-use-tensor-board.html"/><meta property="og:image" content="https://hinaser.github.io/Machine-Learning/preview.png"/><meta name="twitter:title" content="TensorBoardの使い方"/><meta name="twitter:description" content="TensorBoardの使い方を具体例とともに解説します。"/><meta name="twitter:url" content="https://hinaser.github.io/Machine-Learning/how-to-use-tensor-board.html"/><meta name="twitter:image" content="https://hinaser.github.io/Machine-Learning/preview.png"/><title>TensorBoardの使い方</title><link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/><link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css"/><script defer="" src="https://code.getmdl.io/1.3.0/material.min.js"></script><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/><link href="https://fonts.googleapis.com/earlyaccess/notosansjapanese.css" rel="stylesheet"/><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link rel="stylesheet" href="css/lib.css?d41d8cd98f" type="text/css" data-turbolinks-track="reload"/><link rel="stylesheet" href="css/main.css?c37d720838" type="text/css" data-turbolinks-track="reload"/><script id="st_insights_js" type="text/javascript" src="https://ws.sharethis.com/button/buttons.js?publisher=8fde68e6-f234-4808-b7ab-c498ac41fe48"></script><script type="text/javascript">stLight.options({
    publisher: "8fde68e6-f234-4808-b7ab-c498ac41fe48",
    doNotHash: true,
    doNotCopy: true,
    hashAddressBar: false
});</script><script src="js/lib.js?25c054e326" data-turbolinks-track="reload"></script></head><body><div class="dpln-layout top-header-left-nav-layout fixed-top"><header class="dpln-layout-header"><i class="material-icons" id="toggle-nav">view_headline</i><span class="site-title">機械学習、ディープラーニング</span></header><nav class="dpln-layout-nav"><figure class="collapsible" data-page="learntensorflowplayground"><figcaption><span class="menu-title">TensorFlow Playgroundの仕組み</span><button class="mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">keyboard_arrow_down</i></button></figcaption><ul><li><a href="index.html#preface-part">はじめに</a></li><li><a href="index.html#reference-part">参考文献</a></li><li><a href="index.html#summary-part">Playgroundの仕組み</a></li><li><a href="index.html#learningsettings-part">ニューラルネットワークについて</a></li><li><a href="index.html#about-learning-in-nn-part">ニューラルネットワークの学習に関する設定</a></li><li><a href="index.html#learningrate-part">学習率</a></li><li><a href="index.html#activator-part">活性化関数</a></li><li><a href="index.html#regularization-part">正則化、正則化項</a></li><li><a href="index.html#problemtype-part">統計モデルの種類</a></li><li><a href="index.html#inputdata-part">データに関する設定</a></li><li><a href="index.html#dataselection-part">どのデータセットを使うか</a></li><li><a href="index.html#ratio-of-training-data-part">トレーニングデータの割合</a></li><li><a href="index.html#noise-part">ノイズ</a></li><li><a href="index.html#batchsize-part">バッチサイズ</a></li><li><a href="index.html#feature-part">入力するデータの特徴と隠し層</a></li><li><a href="index.html#backpropagation-part">バックプロパゲーション(誤差逆伝搬法)</a></li></ul></figure><figure class="collapsible" data-page="[&quot;deeplearning-by-tensorflow&quot;, &quot;how-to-use-tensorboard&quot;, &quot;tensorflow-faq&quot;]"><figcaption><span class="menu-title">TensorFlowでディープラーニング</span><button class="mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">keyboard_arrow_down</i></button></figcaption><div class="dpln-expand"></div><ul><li><a href="deeplearning-by-tensorflow.html">TensorFlowのインストール</a></li><li><a href="deeplearning-by-tensorflow-with-gpu.html">TensorFlowのインストール(GPU利用編)</a></li><li><a href="how-to-use-tensorboard.html">TensorBoardの使い方</a></li><li><a href="tensorflow-faq.html">TensorFlow FAQ</a></li></ul></figure><figure class="collapsible" data-page="[&quot;sample-rock-scissors-paper&quot;]"><figcaption><span class="menu-title">TensorFlow コードサンプル</span><button class="mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">keyboard_arrow_down</i></button></figcaption><ul><li><a href="sample-rock-scissors-paper.html">じゃんけんの勝ち方を学習させるデモ</a></li></ul></figure><figure class="collapsible" data-page="math-for-ml"><figcaption><span class="menu-title">機械学習のための数学</span><button class="mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">keyboard_arrow_down</i></button></figcaption><ul><li><a href="math-for-ml.html">はじめに</a></li><li><a href="math-for-ml.html#random-variable">確率変数</a></li><li><a href="math-for-ml.html#probability-distribution">確率分布</a></li><li><a href="math-for-ml.html#pmf">離散確率分布</a></li><li><a href="math-for-ml.html#pdf">連続確率分布</a></li><li><a href="math-for-ml.html#expectation">期待値</a></li><li><a href="math-for-ml.html#self-information">自己情報量</a></li><li><a href="math-for-ml.html#entropy">エントロピー</a></li><li><a href="math-for-ml.html#kl-divergence">KL情報量</a></li><li><a href="math-for-ml.html#cross-entropy">クロスエントロピー</a></li><li><a href="math-for-ml.html#logits">ロジット</a></li><li><a href="math-for-ml.html#softmax">ソフトマックス関数</a></li><li><a href="math-for-ml.html#sigmoid">シグモイド関数</a></li><li><a href="math-for-ml.html#multiclass-classification">多クラス分類</a></li><li><a href="math-for-ml.html#multilabel-classification">マルチラベル分類</a></li></ul></figure><figure class="collapsible" data-page="[&quot;profile&quot;, &quot;reference&quot;, &quot;useful-tools-and-services&quot;, &quot;private-thoughts&quot;]"><figcaption><span class="menu-title">その他</span><button class="mdl-button mdl-js-button mdl-button--icon"><i class="material-icons">keyboard_arrow_down</i></button></figcaption><ul><li><a href="profile.html">著者プロフィール</a></li><li><a href="reference.html">参考サイト集</a></li><li><a href="useful-tools-and-services.html">お世話になっているツール/サービス</a></li><li><a href="private-thoughts.html">独り言</a></li></ul></figure></nav><main class="dpln-layout-main"><article class="main-article" data-page="how-to-use-tensorboard"><a class="in-page-anchor" id="preface"></a><h1>TensorBoardの使い方</h1><div class="article-metadata"><div id="post-date"><i class="material-icons md-24">timer</i><span>2017-04-04</span></div><div id="author"><i class="material-icons md-24">person</i><span>Hinase</span></div><span class="author-external-profile"><a class="header-logo-invertocat" href="https://github.com/Hinaser" aria-label="Github Profile" target="_blank"><svg class="octicon octicon-mark-github" aria-hidden="true" height="24" version="1.1" viewbox="0 0 16 16" width="24" fill="rgba(0, 0, 0, 0.7)"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg></a><a class="header-logo-twitter" href="https://twitter.com/h1nase" target="_blank" style="line-height: 30px; display: inline-block; vertical-align: middle; margin-left: 10px; margin-right: 10px"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 400 400" height="24"><defs><style>.cls-1 {
  fill: #1da1f2;
}

.cls-2 {
  fill: #fff;
}

.cls-3 {
  fill: none;
}</style></defs><title>Twitter_Logo_White-on-Blue</title><g id="Dark_Blue" data-name="Dark Blue"><rect class="cls-1" width="400" height="400"></rect></g><g id="Logo_FIXED" data-name="Logo — FIXED"><path class="cls-2" d="M153.62 301.59c94.34 0 145.94-78.16 145.94-145.94 0-2.22 0-4.43-.15-6.63A104.36 104.36 0 0 0 325 122.47a102.38 102.38 0 0 1-29.46 8.07 51.47 51.47 0 0 0 22.55-28.37 102.79 102.79 0 0 1-32.57 12.45 51.34 51.34 0 0 0-87.41 46.78A145.62 145.62 0 0 1 92.4 107.81a51.33 51.33 0 0 0 15.88 68.47A50.91 50.91 0 0 1 85 169.86c0 .21 0 .43 0 .65a51.31 51.31 0 0 0 41.15 50.28 51.21 51.21 0 0 1-23.16.88 51.35 51.35 0 0 0 47.92 35.62 102.92 102.92 0 0 1-63.7 22A104.41 104.41 0 0 1 75 278.55a145.21 145.21 0 0 0 78.62 23"></path><rect class="cls-3" width="400" height="400"></rect></g></svg></a></span><span class="social-share"><span class="st_facebook_hcount" displaytext="Facebook"></span><span class="st_twitter_hcount" displaytext="Tweet"></span><span class="st_googleplus_hcount" displaytext="Google +"></span></span></div><div class="paragraph"><p>TensorBoardはTensorFlowでコーディングした計算グラフを可視化するツールです。
TensorFlowインストール時に一緒にインストールされます。<br/>BASHシェル上から</p><code class="code">tensorboard --logdir=<ログディレクトリのパス※後述></code><p>と実行することにより、http://localhost:6006でTensorBoardのWeb画面にアクセスできるようになります。</p><p>--logdirのオプションを見て分かる通り、TensorBoardで機械学習モデルを可視化するためには
そのモデルのグラフ等のデータが必要になります。</p><p>このTensorBoardで利用するデータは下記のTensorFlow APIで生成されるものを利用します。<br/><a href="https://www.tensorflow.org/api_docs/python/tf/summary/FileWriter" target="_blank">tf.summary.FileWriter('ログ出力先ディレクトリ', グラフ)</a></p><p>このAPIがTensorFlowのpythonスクリプト内で実行されると、
それまでにグラフに登録されたOperation(変数の演算など)やTensorの計算グラフ全体がTensorBoard上に表示されるようになります。<br/>計算グラフの可視化をするだけであれば上記のtf.summary.FileWriterをTensowFlowのpythonコード中に一行書いてあげればそれでOKです。</p><div class="graph-image"><img src="image/how-to-use-tensorboard/computational-graph-sample.png" alt="computationnal graph image"/></div><h4>学習過程のパラメータの変化を追う場合</h4><p>実際にTensorBoardを使う場合は計算グラフだけではなくトレーニングの過程での誤差の推移等
を確認したい場合が多いと思います。このような場合は下記のAPIを利用し、scalar値として時系列推移グラフを登録します。<br/><a href="https://www.tensorflow.org/api_docs/python/tf/summary/scalar" target="_blank">summary_op = tf.summary.scalar('loss', loss)</a><br/>上記のtf.summary.scalarで監視対象のスカラー(0次元テンソル)をオペレーションとしてグラフに登録し、
打刻したい時点でこのsummary_opをセッション上で実行すると都度その時点でのスカラー値がグラフにプロットされ、
TensorBoardのScalarsタブに下記のような
時系列グラフが表示されるようになります。(正確には横軸は時刻ではなく学習のステップになります。)</p><div class="graph-image"><img src="image/how-to-use-tensorboard/summary-sample.png" alt="Summary graph image"/></div><p>その他TensorBoardではヒストグラムや画像、オーディオ等のデータを扱うことができます。ここでは紹介しませんが、
興味ある人は<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/tensorboard/README.md" target="_blank">このTensorBoardのREADME</a>を確認してください。</p><h4>サンプル機械学習モデル</h4><p>断片的にコード片を見ても実感が湧かないと思いますので、
実例を元に全体像を説明します。</p><p>TensorFlowを用いて以下のシンプルな行列計算の係数行列$\boldsymbol A$および$\boldsymbol b$の値を推定する機械学習モデルを作り、
これをTensorBoardで可視化することを考えます。
$$
\boldsymbol{y} = \boldsymbol{A} \boldsymbol{x} + \boldsymbol{b}
$$
ここで$\boldsymbol{x}$は入力データ、$\boldsymbol{y}$は出力データとします。</p><p>今回はTensorFlowで
$$ \left(\begin{array}{c} y_1\\y_2\\y_3 \end{array} \right) = \begin{pmatrix} 2&0&0\\0&2&0\\0&0&2 \end{pmatrix} \left(\begin{array}{c} x_1\\x_2\\x_3 \end{array} \right)$$
となるようにモデルを組んでみます。<br/>つまり、学習の結果
$$ \boldsymbol{A} = 2 \boldsymbol{I}\\\boldsymbol{b} = \left(\begin{array}{c} 0\\0\\0 \end{array} \right) $$
に収束するような学習モデルを作ります。ここで $\boldsymbol{I}$ は $3\times3$の単位行列です。</p><p>このモデルを実現するために例えば下記のようなトレーニングデータを用意します。
$$
x = \left(\begin{array}{c} 5\\2\\3 \end{array} \right),\,
y = \left(\begin{array}{c} 10\\4\\6 \end{array} \right)\\
x = \left(\begin{array}{c} 1\\8\\2 \end{array} \right),\,
y = \left(\begin{array}{c} 2\\16\\4 \end{array} \right)\\
\vdots\\
x = \left(\begin{array}{c} x_1\\x_2\\x_3 \end{array} \right),\,
y = \left(\begin{array}{c} 2x_1\\2x_2\\2x_3 \end{array} \right)
$$
この学習データをTensorFlowの機械学習モデルに入力し、$\boldsymbol{A}, \boldsymbol{b}$の値を学習させます。<br/><strong>ランダム</strong>に生成した$x_1,x_2,x_3$に対して$y_1=2x_1,\, y_2=2x_2,\, y_3=2x_3$を正解データとして組み合わせます。</p><p>ちなみに、筆者ははじめ
$$
x = \left(\begin{array}{c} 1\\1\\1 \end{array} \right),\,
x = \left(\begin{array}{c} 2\\2\\2 \end{array} \right),\,
x = \left(\begin{array}{c} 3\\3\\3 \end{array} \right)
$$
のように$x_1 = x_2 = x_3$とした単純な学習データを作り学習させて大失敗しました。<br/>この状態で学習させるとどのような$\boldsymbol{A}, \boldsymbol{b}$が導かれるのか、
なぜその値になるのか時間のある人は考えてみてください。</p><p>今回利用するPythonのコードは下記のとおりです。<br/>下記のコードの背景薄緑色の箇所がTensorBoardに関連するコードです。</p></div><code class="sample-python-code"><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008800; font-weight: bold">import</span>&nbsp;<span style="color: #0e84b5; font-weight: bold">numpy</span>&nbsp;<span style="color: #008800; font-weight: bold">as</span>&nbsp;<span style="color: #0e84b5; font-weight: bold">np</span><br/><span style="color: #008800; font-weight: bold">import</span>&nbsp;<span style="color: #0e84b5; font-weight: bold">tensorflow</span>&nbsp;<span style="color: #008800; font-weight: bold">as</span>&nbsp;<span style="color: #0e84b5; font-weight: bold">tf</span><br/><br/><span style="color: #888888"># セッションを生成</span><br/>sess&nbsp;<span style="color: #333333">=</span>&nbsp;tf<span style="color: #333333">.</span>InteractiveSession()<br/><br/><span style="color: #888888"># トレーニングするパラメータを定義</span><br/>A&nbsp;<span style="color: #333333">=</span>&nbsp;tf<span style="color: #333333">.</span>Variable(tf<span style="color: #333333">.</span>zeros(shape<span style="color: #333333">=</span>[<span style="color: #0000DD; font-weight: bold">3</span>,<span style="color: #0000DD; font-weight: bold">3</span>]), dtype<span style="color: #333333">=</span>tf<span style="color: #333333">.</span>float32, name<span style="color: #333333">=</span><span style="background-color: #fff0f0">&quot;A&quot;</span>)<br/>b&nbsp;<span style="color: #333333">=</span>&nbsp;tf<span style="color: #333333">.</span>Variable(tf<span style="color: #333333">.</span>zeros(shape<span style="color: #333333">=</span>[<span style="color: #0000DD; font-weight: bold">3</span>,<span style="color: #0000DD; font-weight: bold">1</span>]), dtype<span style="color: #333333">=</span>tf<span style="color: #333333">.</span>float32, name<span style="color: #333333">=</span><span style="background-color: #fff0f0">&quot;b&quot;</span>)<br/>sess<span style="color: #333333">.</span>run(tf<span style="color: #333333">.</span>global_variables_initializer())<br/><br/><span style="color: #888888"># 学習用入力データのプレースホルダの定義</span><br/>x&nbsp;<span style="color: #333333">=</span>&nbsp;tf<span style="color: #333333">.</span>placeholder(tf<span style="color: #333333">.</span>float32, shape<span style="color: #333333">=</span>[<span style="color: #0000DD; font-weight: bold">3</span>,<span style="color: #0000DD; font-weight: bold">1</span>], name<span style="color: #333333">=</span><span style="background-color: #fff0f0">&quot;x&quot;</span>)<br/><span style="color: #888888"># 学習用出力データのプレースホルダの定義</span><br/>y&nbsp;<span style="color: #333333">=</span> tf<span style="color: #333333">.</span>placeholder(tf<span style="color: #333333">.</span>float32, shape<span style="color: #333333">=</span>[<span style="color: #0000DD; font-weight: bold">3</span>,<span style="color: #0000DD; font-weight: bold">1</span>], name<span style="color: #333333">=</span><span style="background-color: #fff0f0">&quot;y&quot;</span>)<br/><br/><span style="color: #888888"># 機械学習のモデルを定義</span><br/>y_<span style="color: #333333">=</span> tf<span style="color: #333333">.</span>matmul(A, x)<span style="color: #333333">+</span> b<br/><br/><span style="color: #888888"># 誤差を定義</span><br/><span style="color: #008800; font-weight: bold">with</span> tf<span style="color: #333333">.</span>name_scope(<span style="background-color: #fff0f0">&apos;loss&apos;</span>):<br/>&nbsp;&nbsp;&nbsp;&nbsp;loss&nbsp;<span style="color: #333333">=</span> tf<span style="color: #333333">.</span>reduce_mean(tf<span style="color: #333333">.</span>square(y_<span style="color: #333333">-</span> y))<br/><br/><span style="color: #888888"># トレーニングアルゴリズムを定義</span><br/><span style="color: #008800; font-weight: bold">with</span> tf<span style="color: #333333">.</span>name_scope(<span style="background-color: #fff0f0">&apos;train&apos;</span>):<br/>&nbsp;&nbsp;&nbsp;&nbsp;learning_rate<span style="color: #333333">=</span><span style="color: #6600EE; font-weight: bold">1.0e-3</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;train<span style="color: #333333">=</span> tf<span style="color: #333333">.</span>train<span style="color: #333333">.</span>GradientDescentOptimizer(learning_rate)<span style="color: #333333">.</span>minimize(loss)<br/><br/><div class="summary-code" style="background-color: rgba(0,220,64,.4); border-radius: 6px"><span style="color: #888888"># TensorBoardで追跡する変数を定義</span><br/><span style="color: #008800; font-weight: bold">with</span> tf<span style="color: #333333">.</span>name_scope(<span style="background-color: #fff0f0">&apos;summary&apos;</span>):<br/>&nbsp;&nbsp;&nbsp;&nbsp;writer&nbsp;<span style="color: #333333">=</span> tf<span style="color: #333333">.</span>summary<span style="color: #333333">.</span>FileWriter(<span style="background-color: #fff0f0">&apos;/tmp/tensorboard-sample&apos;</span>, sess<span style="color: #333333">.</span>graph)<br/>&nbsp;&nbsp;&nbsp;&nbsp;tf<span style="color: #333333">.</span>summary<span style="color: #333333">.</span>scalar(<span style="background-color: #fff0f0">&apos;A&apos;</span>, tf<span style="color: #333333">.</span>reshape(tf<span style="color: #333333">.</span>matrix_determinant(A), []))<br/>&nbsp;&nbsp;&nbsp;&nbsp;tf<span style="color: #333333">.</span>summary<span style="color: #333333">.</span>scalar(<span style="background-color: #fff0f0">&apos;b&apos;</span>, tf<span style="color: #333333">.</span>reshape(tf<span style="color: #333333">.</span>norm(b), []))<br/>&nbsp;&nbsp;&nbsp;&nbsp;tf<span style="color: #333333">.</span>summary<span style="color: #333333">.</span>scalar(<span style="background-color: #fff0f0">&apos;loss&apos;</span>, loss)<br/>&nbsp;&nbsp;&nbsp;&nbsp;merged&nbsp;<span style="color: #333333">=</span> tf<span style="color: #333333">.</span>summary<span style="color: #333333">.</span>merge_all()</div><br/><span style="color: #888888"># トレーニングデータを生成</span><br/>samples_count&nbsp;<span style="color: #333333">=</span>&nbsp;<span style="color: #0000DD; font-weight: bold">100</span><br/>x_input&nbsp;<span style="color: #333333">=</span> np<span style="color: #333333">.</span>ndarray(shape<span style="color: #333333">=</span>[samples_count,<span style="color: #0000DD; font-weight: bold">3</span>,<span style="color: #0000DD; font-weight: bold">1</span>])<br/>y_input&nbsp;<span style="color: #333333">=</span> np<span style="color: #333333">.</span>ndarray(shape<span style="color: #333333">=</span>[samples_count,<span style="color: #0000DD; font-weight: bold">3</span>,<span style="color: #0000DD; font-weight: bold">1</span>])<br/><span style="color: #008800; font-weight: bold">for</span> i&nbsp;<span style="color: #000000; font-weight: bold">in</span>&nbsp;<span style="color: #007020">range</span>(samples_count):<br/>&nbsp;&nbsp;&nbsp;&nbsp;x_input[i][<span style="color: #0000DD; font-weight: bold">0</span>]&nbsp;<span style="color: #333333">=</span> np<span style="color: #333333">.</span>random<span style="color: #333333">.</span>rand()<br/>&nbsp;&nbsp;&nbsp;&nbsp;x_input[i][<span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">=</span> np<span style="color: #333333">.</span>random<span style="color: #333333">.</span>rand()<br/>&nbsp;&nbsp;&nbsp;&nbsp;x_input[i][<span style="color: #0000DD; font-weight: bold">2</span>]&nbsp;<span style="color: #333333">=</span> np<span style="color: #333333">.</span>random<span style="color: #333333">.</span>rand()<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008800; font-weight: bold">for</span> j&nbsp;<span style="color: #000000; font-weight: bold">in</span>&nbsp;<span style="color: #007020">range</span>(<span style="color: #0000DD; font-weight: bold">3</span>):<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;y_input[i][j]&nbsp;<span style="color: #333333">=</span>&nbsp;x_input[i][j]<span style="color: #333333">*</span>&nbsp;<span style="color: #0000DD; font-weight: bold">2</span><br/><br/><span style="color: #888888"># 学習開始</span><br/>summary&nbsp;<span style="color: #333333">=</span>&nbsp;<span style="color: #007020">None</span><br/>total_epochs&nbsp;<span style="color: #333333">=</span>&nbsp;<span style="color: #0000DD; font-weight: bold">1000</span><br/><span style="color: #008800; font-weight: bold">for</span> _&nbsp;<span style="color: #000000; font-weight: bold">in</span>&nbsp;<span style="color: #007020">range</span>(total_epochs):<br/><span style="color: #008800; font-weight: bold">&nbsp;&nbsp;&nbsp;&nbsp;for</span> i&nbsp;<span style="color: #000000; font-weight: bold">in</span>&nbsp;<span style="color: #007020">range</span>(samples_count):<div class="summary-code" style="background-color: rgba(0,220,64,.4); border-radius: 6px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__, summary&nbsp;<span style="color: #333333">=</span> sess<span style="color: #333333">.</span>run([train, merged], feed_dict<span style="color: #333333">=</span>{x: x_input[i], y: y_input[i]})</div><br/><span style="color: #888888">&nbsp;&nbsp;&nbsp;&nbsp;# 進捗10%毎に途中経過をコンソール出力、TensorBoardに監視対象変数の値を記録</span><br/>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008800; font-weight: bold">if</span> _<span style="color: #333333">%</span> (total_epochs<span style="color: #333333">/</span><span style="color: #0000DD; font-weight: bold">10</span>)&nbsp;<span style="color: #333333">==</span>&nbsp;<span style="color: #0000DD; font-weight: bold">0</span>:<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curr_A, curr_b, curr_loss<span style="color: #333333">=</span> sess<span style="color: #333333">.</span>run([A, b, loss], feed_dict<span style="color: #333333">=</span>{x: x_input[_<span style="color: #333333">%</span> samples_count], y: y_input[_<span style="color: #333333">%</span> samples_count]})<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&apos;-----------------------------&apos;</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&apos;y&apos;</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008800; font-weight: bold">print</span>(y_input[_<span style="color: #333333">%</span> samples_count])<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&apos;A&apos;</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008800; font-weight: bold">print</span>(curr_A)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&apos;x&apos;</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008800; font-weight: bold">print</span>(x_input[_<span style="color: #333333">%</span> samples_count])<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&apos;b&apos;</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008800; font-weight: bold">print</span>(curr_b)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&apos;loss&apos;</span>)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #008800; font-weight: bold">print</span>(curr_loss)<br/><div class="summary-code" style="background-color: rgba(0,220,64,.4); border-radius: 6px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writer<span style="color: #333333">.</span>add_summary(summary, _)</div><br/><span style="color: #888888"># 学習結果の確認</span><br/><span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&apos;==========================&apos;</span>)<br/><span style="color: #888888"># x = (1,2,3) を入力すると (2,4,6)に近いベクトルが出力されるはずだが、実際にどうなるか確認。</span><br/>x_test<span style="color: #333333">=</span> np<span style="color: #333333">.</span>array([<span style="color: #0000DD; font-weight: bold">1</span>,<span style="color: #0000DD; font-weight: bold">2</span>,<span style="color: #0000DD; font-weight: bold">3</span>])<span style="color: #333333">.</span>reshape([<span style="color: #0000DD; font-weight: bold">3</span>,<span style="color: #0000DD; font-weight: bold">1</span>])<br/>y_test&nbsp;<span style="color: #333333">=</span> np<span style="color: #333333">.</span>array([<span style="color: #0000DD; font-weight: bold">2</span>,<span style="color: #0000DD; font-weight: bold">4</span>,<span style="color: #0000DD; font-weight: bold">6</span>])<span style="color: #333333">.</span>reshape([<span style="color: #0000DD; font-weight: bold">3</span>,<span style="color: #0000DD; font-weight: bold">1</span>])<br/>estimated_y, final_loss&nbsp;<span style="color: #333333">=</span> sess<span style="color: #333333">.</span>run([y_, loss], feed_dict<span style="color: #333333">=</span>{x:x_test, y: y_test})<br/><span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&apos;Input x&apos;</span>)<br/><span style="color: #008800; font-weight: bold">print</span>(x_test)<br/><span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&apos;Computed y&apos;</span>)<br/><span style="color: #008800; font-weight: bold">print</span>(estimated_y)<br/><span style="color: #008800; font-weight: bold">print</span>(<span style="background-color: #fff0f0">&apos;loss&apos;</span>)<br/><span style="color: #008800; font-weight: bold">print</span>(final_loss)</pre></div></code><p>それでは緑の箇所をひとつずつ確認していきます。</p><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"></pre><div class="summary-code" style="background-color: rgba(0,220,64,.4); border-radius: 6px"><span style="color: #888888"># TensorBoardで追跡する変数を定義</span><br/><span style="color: #008800; font-weight: bold">with</span> tf<span style="color: #333333">.</span>name_scope(<span style="background-color: #fff0f0">&apos;summary&apos;</span>):<br/>&nbsp;&nbsp;&nbsp;&nbsp;writer&nbsp;<span style="color: #333333">=</span> tf<span style="color: #333333">.</span>summary<span style="color: #333333">.</span>FileWriter(<span style="background-color: #fff0f0">&apos;/tmp/tensorboard-sample&apos;</span>, sess<span style="color: #333333">.</span>graph)<br/>&nbsp;&nbsp;&nbsp;&nbsp;tf<span style="color: #333333">.</span>summary<span style="color: #333333">.</span>scalar(<span style="background-color: #fff0f0">&apos;A&apos;</span>, tf<span style="color: #333333">.</span>reshape(tf<span style="color: #333333">.</span>matrix_determinant(A), []))<br/>&nbsp;&nbsp;&nbsp;&nbsp;tf<span style="color: #333333">.</span>summary<span style="color: #333333">.</span>scalar(<span style="background-color: #fff0f0">&apos;b&apos;</span>, tf<span style="color: #333333">.</span>reshape(tf<span style="color: #333333">.</span>norm(b), []))<br/>&nbsp;&nbsp;&nbsp;&nbsp;tf<span style="color: #333333">.</span>summary<span style="color: #333333">.</span>scalar(<span style="background-color: #fff0f0">&apos;loss&apos;</span>, loss)<br/>&nbsp;&nbsp;&nbsp;&nbsp;merged&nbsp;<span style="color: #333333">=</span> tf<span style="color: #333333">.</span>summary<span style="color: #333333">.</span>merge_all()</div></div><br/><p>まずは最初の緑です。writer = tf.summary.FileWriterによってグラフの可視化とログディレクトリの指定をしています。
FileWriterが実行される直前までのオペレーション、テンソルのグラフノードがTensorBoardに表示されるようになります。<br/>FileWriterをこのブロックの末尾、tf.summary.scalar等のコードのあとに書いてしまうと、サマリーOPのノードも一緒に
グラフに表示されてしまいグラフが見づらくなってしまうので、tf.summary.scalar等のOPの前にFileWriterを実行する処理を記述すると良いです。</p><p>FileWriterが実行されると即時にTensorBoard用のログディレクトリとイベントファイルが作成されます。このイベントファイルにはグラフイメージは
書き込まれていますが、まだtf.summary.scalarで指定した値のデータは書き込まれていません。
TensorBoardの実行に必要なファイル、ディレクトリは作成されているので、この時点でTensorBoard上でグラフを確認することが可能です。</p><p>tf.summary.scalarは上述したように指定したスカラー変数の値を時系列グラフに登録するOPです。OPであるため、セッション上で実行されなければ
時系列グラフも更新されません。
ここでは3つのtf.summary.scalar OPを登録していますが、馬鹿正直にこのOPをそれぞれsess.runで個別に実行するのではなく、通常は
tf.summary.merge_allでこれらのOPを1つのOPにマージし、このマージしたOPを1度セッション上で走らせるようにします。</p><p>特にtf.name_scopeについては言及しませんでしたが、これはwithインデント内のOPを指定した名前でグルーピングするような処理であり、
特に必須の処理ではありません。グラフを見やすくするために煩雑でバラバラなOPをひとまとまりにするために頻繁に利用されます。</p><p>これでTensorBoard用グラフイメージの生成とサマリー記録用のOperationが出来上がりました。
次にサマリーOPのセッション上での実行と、実行結果のファイルへの書き出しをする必要があります。</p><div class="summary-code" style="background-color: rgba(0,220,64,.4); border-radius: 6px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__, summary&nbsp;<span style="color: #333333">=</span> sess<span style="color: #333333">.</span>run([train, merged], feed_dict<span style="color: #333333">=</span>{x: x_input[i], y: y_input[i]})</div><br/><p>サマリーOPの実行は上記のコードでtrainオペレーションと同時に行っています。<br/>サマリーOPをsess.runで実行した結果は変数summaryに<a href="https://en.wikipedia.org/wiki/Protocol_Buffers" target="_blank">Protocol Buffer</a>のフォーマットで入ってきます。</p><div class="summary-code" style="background-color: rgba(0,220,64,.4); border-radius: 6px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;writer<span style="color: #333333">.</span>add_summary(summary, _)</div><br/><p>セッションの実行により得られたサマリーOPのProtocol Bufferの値をTensorBoard用のイベントログに上記で追記しています。
TensorBoardは一定の間隔でイベントログを確認します。そのため、機械学習実行中の経過をTensorBoardで確認することも可能です。</p><div id="disqus_thread"></div><script>var disqus_config = function () {
    this.page.url = document.location.href;
    this.page.identifier = document.location.pathname;
};
(function () { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://hinaser-github-io-machine-learning.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script></article><script type="text/javascript" async="" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
tex2jax: {
inlineMath: [['$','$']],
processEscapes: true
},
CommonHTML: {matchFontHeight: false },
displayAlign: "left",
displayIndent: "2em"
});

</script></main></div><script src="js/main.js?715b4031ca" data-turbolinks-track="reload"></script><script src="js/raw/analytics.js" data-turbolinks-track="reload"></script></body></html>