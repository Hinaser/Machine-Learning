!function r(s,o,l){function u(a,t){if(!o[a]){if(!s[a]){var e="function"==typeof require&&require;if(!t&&e)return e(a,!0);if(c)return c(a,!0);var n=new Error("Cannot find module '"+a+"'");throw n.code="MODULE_NOT_FOUND",n}var i=o[a]={exports:{}};s[a][0].call(i.exports,function(t){var e=s[a][1][t];return u(e||t)},i,i.exports,r,s,o,l)}return o[a].exports}for(var c="function"==typeof require&&require,t=0;t<l.length;t++)u(l[t]);return u}({1:[function(t,e,a){"use strict";var n="en";function i(t){if("ja"==t||"en"==t)if("en"==t)$("[data-i18n='toggleplaygroundvisibility']").text("Click this button to toggle playground visible/hidden."),$("[data-i18n='togglecolortheme']").text("You can switch theme color of this website"),$("[data-i18n='headertitle']").html('Tinker With a <b>Neural Network</b> <span class="optional">Right Here </span>in Your Browser.<br>Don’t Worry, You Can’t Break It. We Promise.'),$("[data-i18n='iterations']").text("Iterations"),$("[data-i18n='learnmingrate']").text("Learning rate"),$("[data-i18n='activation']").text("Activation"),$("[data-i18n='sigmoid']").text("Sigmoid"),$("[data-i18n='linear']").text("Linear"),$("[data-i18n='regularization']").text("Regularization"),$("[data-i18n='regularizationrate']").text("Regularization rate"),$("[data-i18n='problemtype']").text("Problem type"),$("[data-i18n='classification']").text("Classification"),$("[data-i18n='regression']").text("Regression"),$("[data-i18n='data']").text("Data"),$("[data-i18n='whichdataset']").text("Which dataset do you want to use?"),$("[data-i18n='circle']").attr("title","Circle"),$("[data-i18n='exclusiveor']").attr("title","Exclusive or"),$("[data-i18n='gaussian']").attr("title","Gaussian"),$("[data-i18n='spiral']").attr("title","Spiral"),$("[data-i18n='plane']").attr("title","Plane"),$("[data-i18n='multigaussian']").attr("title","Multi gaussian"),$("[data-i18n='rationoftrainingdata']").text("Ratio of training to test data:"),$("[data-i18n='noise']").text("Noise:"),$("[data-i18n='batchsize']").text("Batch size:"),$("[data-i18n='regen']").text("Regenerate"),$("[data-i18n='regen']").attr("title","Regenerate data"),$("[data-i18n='features']").text("Features"),$("[data-i18n='whichproperty']").text("Which properties do you want to feed in?"),$("[data-i18n='clickanywheretoedit']").text("Click anywhere to edit."),$("[data-i18n='thumbnaillabel']").html("This is the output from one <b>neuron</b>. Hover to see it larger."),$("[data-i18n='weightslabel']").html("The outputs are mixed with varying <b>weights</b>, shown by the thickness of the lines."),"1"==$("#num-layers").text()&&$("[data-i18n='layerslabel']").text("Hidden layer"),"1"!=$("#num-layers").text()&&$("[data-i18n='layerslabel']").text("Hidden layers"),$("[data-i18n='output']").text("Output"),$("[data-i18n='testloss']").text("Test loss"),$("[data-i18n='trainingloss']").text("Training loss"),$("[data-i18n='colorsshowsdata']").text(" Colors shows data, neuron and weight values."),$("[data-i18n='showtestdata']").text("Show test data"),$("[data-i18n='discretizeoutput']").text("Discretize output");else if("ja"==t){$("[data-i18n='toggleplaygroundvisibility']").text("デモの非表示/表示を切り替えられます。"),$("[data-i18n='togglecolortheme']").text("サイトのテーマカラーを切り替えられます。"),$("[data-i18n='headertitle']").html('<span class="optional">ブラウザ上で</span><b>ニューラルネットワーク</b>のメカニズムを検証してみよう。<br>何も壊れないから心配はいらない。'),$("[data-i18n='iterations']").text("エポック"),$("[data-i18n='learnmingrate']").text("学習率"),$("[data-i18n='activation']").text("活性化関数"),$("[data-i18n='sigmoid']").text("シグモイド関数"),$("[data-i18n='linear']").text("線形関数"),$("[data-i18n='regularization']").text("正則化"),$("[data-i18n='regularizationrate']").text("正則化項"),$("[data-i18n='problemtype']").text("統計モデルの種類"),$("[data-i18n='classification']").text("分類"),$("[data-i18n='regression']").text("回帰"),$("[data-i18n='data']").text("データ"),$("[data-i18n='whichdataset']").text("どのデータセットを使いますか?"),$("[data-i18n='circle']").attr("title","円"),$("[data-i18n='exclusiveor']").attr("title","排他OR"),$("[data-i18n='gaussian']").attr("title","ガウシアン"),$("[data-i18n='spiral']").attr("title","螺旋"),$("[data-i18n='plane']").attr("title","平面"),$("[data-i18n='multigaussian']").attr("title","マルチガウシアン"),$("[data-i18n='rationoftrainingdata']").text("トレーニングデータの割合:"),$("[data-i18n='noise']").text("ノイズ:"),$("[data-i18n='batchsize']").text("バッチサイズ:"),$("[data-i18n='regen']").text("再生成"),$("[data-i18n='regen']").attr("title","データを再生成する"),$("[data-i18n='features']").text("特徴"),$("[data-i18n='whichproperty']").text("入力するデータの特徴を選択してください"),$("[data-i18n='clickanywheretoedit']").text("クリックして値を編集"),$("[data-i18n='thumbnaillabel']").html("この<b>ニューロン</b>の出力です。マウスオーバーすると拡大して見れます。"),$("[data-i18n='weightslabel']").html("ニューロンの出力は<b>重み</b>の影響を受けます。重みは線の太さと色で表されます。");var e=+$("#num-layers").text();0==e||10<=e?$("[data-i18n='layerslabel']").text("個の隠し層"):$("[data-i18n='layerslabel']").text("つの隠し層"),$("[data-i18n='output']").text("出力"),$("[data-i18n='testloss']").text("誤差(テスト)"),$("[data-i18n='trainingloss']").text("誤差(トレーニング)"),$("[data-i18n='colorsshowsdata']").text("データやニューロン、重みの値は色で表現されます。"),$("[data-i18n='showtestdata']").text("テストデータを表示する"),$("[data-i18n='discretizeoutput']").text("出力を離散化する")}}a.currentLang=function(){return n},a.init=function(e){e&&("en"==e||"ja"==e)||(e="en"),n=e,$(function(){$("#playground-content");var t=$("#lang-selection button");i(e),t.on("click",function(t){var e=$(this).data("lang");e!=n&&i(n=e)})})}},{}],2:[function(t,e,a){"use strict";function d(t,e){return Math.random()*(e-t)+t}function u(t,e){var a,n,i;for(void 0===t&&(t=0),void 0===e&&(e=1);1<(i=(a=2*Math.random()-1)*a+(n=2*Math.random()-1)*n););var r=Math.sqrt(-2*Math.log(i)/i)*a;return t+Math.sqrt(e)*r}function h(t,e){var a=t.x-e.x,n=t.y-e.y;return Math.sqrt(a*a+n*n)}a.shuffle=function(t){for(var e=t.length,a=0,n=0;0<e;)n=Math.floor(Math.random()*e),a=t[--e],t[e]=t[n],t[n]=a},a.classifyTwoGaussData=function(s,t){var o=[],l=d3.scale.linear().domain([0,.5]).range([.5,4])(t);function e(t,e,a){for(var n=0;n<s/2;n++){var i=u(t,l),r=u(e,l);o.push({x:i,y:r,label:a})}}return e(2,2,1),e(-2,-2,-1),o},a.regressPlane=function(t,e){for(var a=d3.scale.linear().domain([-10,10]).range([-1,1]),n=[],i=0;i<t;i++){var r=d(-6,6),s=d(-6,6),o=d(-6,6)*e,l=d(-6,6)*e,u=a(r+o+(s+l));n.push({x:r,y:s,label:u})}return n},a.regressGaussian=function(t,e){var a=[],o=d3.scale.linear().domain([0,2]).range([1,0]).clamp(!0),n=[[-4,2.5,1],[0,2.5,-1],[4,2.5,1],[-4,-2.5,-1],[0,-2.5,1],[4,-2.5,-1]];function i(i,r){var s=0;return n.forEach(function(t){var e=t[0],a=t[1],n=t[2]*o(h({x:i,y:r},{x:e,y:a}));Math.abs(n)>Math.abs(s)&&(s=n)}),s}for(var r=0;r<t;r++){var s=d(-6,6),l=d(-6,6),u=i(s+d(-6,6)*e,l+d(-6,6)*e);a.push({x:s,y:l,label:u})}return a},a.classifySpiralData=function(t,o){var l=[],u=t/2;function e(t,e){for(var a=0;a<u;a++){var n=a/u*5,i=1.75*a/u*2*Math.PI+t,r=n*Math.sin(i)+d(-1,1)*o,s=n*Math.cos(i)+d(-1,1)*o;l.push({x:r,y:s,label:e})}}return e(0,1),e(Math.PI,-1),l},a.classifyCircleData=function(t,e){var a=[],n=5;function i(t,e){return h(t,e)<.5*n?1:-1}for(var r=0;r<t/2;r++){var s=d(0,.5*n),o=d(0,2*Math.PI),l=s*Math.sin(o),u=s*Math.cos(o),c=i({x:l+d(-n,n)*e,y:u+d(-n,n)*e},{x:0,y:0});a.push({x:l,y:u,label:c})}for(r=0;r<t/2;r++){s=d(.7*n,n),o=d(0,2*Math.PI),l=s*Math.sin(o),u=s*Math.cos(o),c=i({x:l+d(-n,n)*e,y:u+d(-n,n)*e},{x:0,y:0});a.push({x:l,y:u,label:c})}return a},a.classifyXORData=function(t,e){for(var a,n=[],i=0;i<t;i++){var r=d(-5,5);r+=0<r?.3:-.3;var s=d(-5,5);s+=0<s?.3:-.3;var o=d(-5,5)*e,l=d(-5,5)*e,u=0<=(a={x:r+o,y:s+l}).x*a.y?1:-1;n.push({x:r,y:s,label:u})}return n}},{}],3:[function(t,e,a){"use strict";var n=(i.prototype.updateTestPoints=function(t){if(this.settings.noSvg)throw Error("Can't add points since noSvg=true");this.updateCircles(this.svg.select("g.test"),t)},i.prototype.updatePoints=function(t){if(this.settings.noSvg)throw Error("Can't add points since noSvg=true");this.updateCircles(this.svg.select("g.train"),t)},i.prototype.updateBackground=function(t,e){var a=t[0].length,n=t.length;if(a!==this.numSamples||n!==this.numSamples)throw new Error("The provided data matrix must be of size numSamples X numSamples");for(var i=this.canvas.node().getContext("2d"),r=i.createImageData(a,n),s=0,o=-1;s<n;++s)for(var l=0;l<a;++l){var u=t[l][s];e&&(u=0<=u?1:-1);var c=d3.rgb(this.color(u));r.data[++o]=c.r,r.data[++o]=c.g,r.data[++o]=c.b,r.data[++o]=160}i.putImageData(r,0,0)},i.prototype.updateCircles=function(t,e){var a=this,n=this.xScale.domain(),i=this.yScale.domain();e=e.filter(function(t){return t.x>=n[0]&&t.x<=n[1]&&t.y>=i[0]&&t.y<=i[1]});var r=t.selectAll("circle").data(e);r.enter().append("circle").attr("r",3),r.attr({cx:function(t){return a.xScale(t.x)},cy:function(t){return a.yScale(t.y)}}).style("fill",function(t){return a.color(t.label)}),r.exit().remove()},i);function i(t,e,a,n,i,r){this.settings={showAxes:!1,noSvg:!1},this.numSamples=e;var s=t,o=r.showAxes?20:0;if(null!=r)for(var l in r)this.settings[l]=r[l];this.xScale=d3.scale.linear().domain(a).range([0,t-2*o]),this.yScale=d3.scale.linear().domain(n).range([s-2*o,0]);var u=d3.scale.linear().domain([0,.5,1]).range(["#f59322","#e8eaeb","#0877bd"]).clamp(!0),c=d3.range(0,1+1e-9,1/30).map(function(t){return u(t)});if(this.color=d3.scale.quantize().domain([-1,1]).range(c),i=i.append("div").style({width:t+"px",height:s+"px",position:"relative",top:"-"+o+"px",left:"-"+o+"px"}),this.canvas=i.append("canvas").attr("width",e).attr("height",e).style("width",t-2*o+"px").style("height",s-2*o+"px").style("position","absolute").style("top",o+"px").style("left",o+"px"),this.settings.noSvg||(this.svg=i.append("svg").attr({width:t,height:s}).style({position:"absolute",left:"0",top:"0"}).append("g").attr("transform","translate("+o+","+o+")"),this.svg.append("g").attr("class","train"),this.svg.append("g").attr("class","test")),this.settings.showAxes){var d=d3.svg.axis().scale(this.xScale).orient("bottom"),h=d3.svg.axis().scale(this.yScale).orient("right");this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+(s-2*o)+")").call(d),this.svg.append("g").attr("class","y axis").attr("transform","translate("+(t-2*o)+",0)").call(h)}}a.HeatMap=n,a.reduceMatrix=function(t,e){if(t.length!==t[0].length)throw new Error("The provided matrix must be a square matrix");if(t.length%e!=0)throw new Error("The width/height of the matrix must be divisible by the reduction factor");for(var a=new Array(t.length/e),n=0;n<t.length;n+=e){a[n/e]=new Array(t.length/e);for(var i=0;i<t.length;i+=e){for(var r=0,s=0;s<e;s++)for(var o=0;o<e;o++)r+=t[n+s][i+o];r/=e*e,a[n/e][i/e]=r}}return a}},{}],4:[function(t,e,a){"use strict";var n=(i.prototype.reset=function(){this.data=[],this.redraw(),this.minY=Number.MAX_VALUE,this.maxY=Number.MIN_VALUE},i.prototype.addDataPoint=function(t){var e=this;if(t.length!==this.numLines)throw Error("Length of dataPoint must equal number of lines");t.forEach(function(t){e.minY=Math.min(e.minY,t),e.maxY=Math.max(e.maxY,t)}),this.data.push({x:this.data.length+1,y:t}),this.redraw()},i.prototype.redraw=function(){var a=this;this.xScale.domain([1,this.data.length]),this.yScale.domain([this.minY,this.maxY]);for(var t=function(e){return d3.svg.line().x(function(t){return a.xScale(t.x)}).y(function(t){return a.yScale(t.y[e])})},e=0;e<this.numLines;e++)this.paths[e].datum(this.data).attr("d",t(e))},i);function i(t,e){this.data=[],this.minY=Number.MAX_VALUE,this.maxY=Number.MIN_VALUE,this.lineColors=e,this.numLines=e.length;var a=t.node(),n=2,i=0,r=2,s=2,o=a.offsetWidth-s-i,l=a.offsetHeight-n-r;this.xScale=d3.scale.linear().domain([0,0]).range([0,o]),this.yScale=d3.scale.linear().domain([0,0]).range([l,0]),this.svg=t.append("svg").attr("width",o+s+i).attr("height",l+n+r).append("g").attr("transform","translate("+s+","+n+")"),this.paths=new Array(this.numLines);for(var u=0;u<this.numLines;u++)this.paths[u]=this.svg.append("path").attr("class","line").style({fill:"none",stroke:e[u],"stroke-width":"1.5px"})}a.AppendingLineChart=n},{}],5:[function(t,e,a){"use strict";var b=(n.prototype.updateOutput=function(){this.totalInput=this.bias;for(var t=0;t<this.inputLinks.length;t++){var e=this.inputLinks[t];this.totalInput+=e.weight*e.source.output}return this.output=this.activation.output(this.totalInput),this.output},n);function n(t,e,a){this.inputLinks=[],this.bias=.1,this.outputs=[],this.outputDer=0,this.inputDer=0,this.accInputDer=0,this.numAccumulatedDers=0,this.id=t,this.activation=e,a&&(this.bias=0)}a.Node=b;var i=(r.SQUARE={error:function(t,e){return.5*Math.pow(t-e,2)},der:function(t,e){return t-e}},r);function r(){}a.Errors=i,Math.tanh=Math.tanh||function(t){if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)};var s=(o.TANH={output:function(t){return Math.tanh(t)},der:function(t){var e=o.TANH.output(t);return 1-e*e}},o.RELU={output:function(t){return Math.max(0,t)},der:function(t){return t<=0?0:1}},o.SIGMOID={output:function(t){return 1/(1+Math.exp(-t))},der:function(t){var e=o.SIGMOID.output(t);return e*(1-e)}},o.LINEAR={output:function(t){return t},der:function(t){return 1}},o);function o(){}a.Activations=s;var l=(u.L1={output:function(t){return Math.abs(t)},der:function(t){return t<0?-1:1}},u.L2={output:function(t){return.5*t*t},der:function(t){return t}},u);function u(){}a.RegularizationFunction=l;var w=function(t,e,a,n){this.weight=Math.random()-.5,this.errorDer=0,this.accErrorDer=0,this.numAccumulatedDers=0,this.id=t.id+"-"+e.id,this.source=t,this.dest=e,this.regularization=a,n&&(this.weight=0)};a.Link=w,a.buildNetwork=function(t,e,a,n,i,r){for(var s=t.length,o=1,l=[],u=0;u<s;u++){var c=u===s-1,d=0===u,h=[];l.push(h);for(var p=t[u],f=0;f<p;f++){var g=o.toString();d?g=i[f]:o++;var v=new b(g,c?a:e,r);if(h.push(v),1<=u)for(var m=0;m<l[u-1].length;m++){var y=l[u-1][m],x=new w(y,v,n,r);y.outputs.push(x),v.inputLinks.push(x)}}}return l},a.forwardProp=function(t,e){var a=t[0];if(e.length!==a.length)throw new Error("The number of inputs must match the number of nodes in the input layer");for(var n=0;n<a.length;n++){a[n].output=e[n]}for(var i=1;i<t.length;i++){var r=t[i];for(n=0;n<r.length;n++){r[n].updateOutput()}}return t[t.length-1][0].output},a.backProp=function(t,e,a){var n=t[t.length-1][0];n.outputDer=a.der(n.output,e);for(var i=t.length-1;1<=i;i--){for(var r=t[i],s=0;s<r.length;s++){(o=r[s]).inputDer=o.outputDer*o.activation.der(o.totalInput),o.accInputDer+=o.inputDer,o.numAccumulatedDers++}for(s=0;s<r.length;s++)for(var o=r[s],l=0;l<o.inputLinks.length;l++){var u=o.inputLinks[l];u.errorDer=o.inputDer*u.source.output,u.accErrorDer+=u.errorDer,u.numAccumulatedDers++}if(1!==i){var c=t[i-1];for(s=0;s<c.length;s++)for(l=(o=c[s]).outputDer=0;l<o.outputs.length;l++){var d=o.outputs[l];o.outputDer+=d.weight*d.dest.inputDer}}}},a.updateWeights=function(t,e,a){for(var n=1;n<t.length;n++)for(var i=t[n],r=0;r<i.length;r++){var s=i[r];0<s.numAccumulatedDers&&(s.bias-=e*s.accInputDer/s.numAccumulatedDers,s.accInputDer=0,s.numAccumulatedDers=0);for(var o=0;o<s.inputLinks.length;o++){var l=s.inputLinks[o],u=l.regularization?l.regularization.der(l.weight):0;0<l.numAccumulatedDers&&(l.weight-=e/l.numAccumulatedDers*(l.accErrorDer+a*u),l.accErrorDer=0,l.numAccumulatedDers=0)}}},a.forEachNode=function(t,e,a){for(var n=e?1:0;n<t.length;n++)for(var i=t[n],r=0;r<i.length;r++){a(i[r])}},a.getOutputNode=function(t){return t[t.length-1][0]}},{}],6:[function(t,e,a){"use strict";var s,b=t("./nn"),w=t("./heatmap"),o=t("./state"),i=t("./dataset"),n=t("./linechart"),r=t("./additionalcontent");d3.select(".more button").on("click",function(){var t;d3.transition().duration(1e3).tween("scroll",(t=800,function(){var e=d3.interpolateNumber(window.pageYOffset||document.documentElement.scrollTop,t);return function(t){scrollTo(0,e(t))}}))});var k,l,I=30,S=5,u=500,c=1200,A=100;(l=k=k||{})[l.BIAS=0]="BIAS",l[l.WEIGHT=1]="WEIGHT";var z={x:{f:function(t,e){return t},label:"X_1"},y:{f:function(t,e){return e},label:"X_2"},xSquared:{f:function(t,e){return t*t},label:"X_1^2"},ySquared:{f:function(t,e){return e*e},label:"X_2^2"},xTimesY:{f:function(t,e){return t*e},label:"X_1X_2"},sinX:{f:function(t,e){return Math.sin(t)},label:"sin(X_1)"},sinY:{f:function(t,e){return Math.sin(e)},label:"sin(X_2)"}},d=[["Show test data","showTestData"],["Discretize output","discretize"],["Play button","playButton"],["Step button","stepButton"],["Reset button","resetButton"],["Learning rate","learningRate"],["Activation","activation"],["Regularization","regularization"],["Regularization rate","regularizationRate"],["Problem type","problem"],["Which dataset","dataset"],["Ratio train data","percTrainData"],["Noise level","noise"],["Batch size","batchSize"],["# of hidden layers","numHiddenLayers"]],h=(p.prototype.playOrPause=function(){this.isPlaying?(this.isPlaying=!1,this.pause()):(this.isPlaying=!0,0==v&&Z(),this.play())},p.prototype.onPlayPause=function(t){this.callback=t},p.prototype.play=function(){this.pause(),this.isPlaying=!0,this.callback&&this.callback(this.isPlaying),this.start(this.timerIndex)},p.prototype.pause=function(){this.timerIndex++,this.isPlaying=!1,this.callback&&this.callback(this.isPlaying)},p.prototype.start=function(t){var e=this;d3.timer(function(){return t<e.timerIndex||(X(),!1)},0)},p);function p(){this.timerIndex=0,this.isPlaying=!1,this.callback=null}var E=o.State.deserializeState();E.getHiddenProps().forEach(function(t){t in z&&delete z[t]});var R={},L=null,N=[-6,6],D=new w.HeatMap(300,A,N,N,d3.select("#heatmap"),{showAxes:!0}),f=d3.scale.linear().domain([0,5]).range([1,10]).clamp(!0),g=d3.scale.linear().domain([-1,0,1]).range(["#f59322","#e8eaeb","#0877bd"]).clamp(!0),v=0,m=[],y=[],$=null,x=0,T=0,O=new h,M=new n.AppendingLineChart(d3.select("#linechart"),["#777","black"]);function P(t,e,a,n,i,r){var s=t-I/2,o=e-I/2,l=i.append("g").attr({class:"node",id:"node"+a,transform:"translate("+s+","+o+")"});l.append("rect").attr({x:0,y:0,width:I,height:I});var u=E[a]?"active":"inactive";if(n){var c=null!=z[a].label?z[a].label:a,d=l.append("text").attr({class:"main-label",x:-10,y:I/2,"text-anchor":"end"});if(/[_^]/.test(c)){for(var h=/(.*?)([_^])(.)/g,p=void 0,f=void 0;null!==(p=h.exec(c));){f=h.lastIndex;var g=p[1],v=p[2],m=p[3];g&&d.append("tspan").text(g),d.append("tspan").attr("baseline-shift","_"==v?"sub":"super").style("font-size","9px").text(m)}c.substring(f)&&d.append("tspan").text(c.substring(f))}else d.append("tspan").text(c);l.classed(u,!0)}n||l.append("rect").attr({id:"bias-"+a,x:-S-2,y:I-S+3,width:S,height:S}).on("mouseenter",function(){Y(k.BIAS,r,d3.mouse(i.node()))}).on("mouseleave",function(){Y(null)});var y=d3.select("#network").insert("div",":first-child").attr({id:"canvas-"+a,class:"canvas"}).style({position:"absolute",left:3+s+"px",top:3+o+"px"}).on("mouseenter",function(){L=a,y.classed("hovered",!0),l.classed("hovered",!0),G($,!1),D.updateBackground(R[a],E.discretize)}).on("mouseleave",function(){L=null,y.classed("hovered",!1),l.classed("hovered",!1),G($,!1),D.updateBackground(R[b.getOutputNode($).id],E.discretize)});n&&(y.on("click",function(){E[a]=!E[a],K=!0,W()}),y.style("cursor","pointer")),n&&y.classed(u,!0);var x=new w.HeatMap(I,A/10,N,N,y,{noSvg:!0});y.datum({heatmap:x,id:a})}function B(t){var e=d3.select("#svg");e.select("g.core").remove(),d3.select("#network").selectAll("div.canvas").remove(),d3.select("#network").selectAll("div.plus-minus-neurons").remove();var a=d3.select(".column.output").node(),n=d3.select(".column.features").node(),i=a.offsetLeft-n.offsetLeft;e.attr("width",i);function r(t){return t*(I+25)}var s={},o=e.append("g").classed("core",!0).attr("transform","translate(3,3)"),l=t.length,u=d3.scale.ordinal().domain(d3.range(1,l-1)).rangePoints([118,i-I],.7),c=d3.select(".callout.thumbnail").style("display","none"),d=d3.select(".callout.weights").style("display","none"),h=null,p=null,f=I/2+50,g=Object.keys(z),v=r(g.length);g.forEach(function(t,e){var a=r(e)+I/2;s[t]={cx:f,cy:a},P(f,a,t,!0,o)});for(var m=1;m<l-1;m++){var y=t[m].length,x=u(m)+I/2;v=Math.max(v,r(y)),H(u(m),m);for(var b=0;b<y;b++){var w=t[m][b],k=r(b)+I/2;s[w.id]={cx:x,cy:k},P(x,k,w.id,!1,o,w);var S=t[m].length,A=t[m+1].length;null==h&&b===S-1&&A<=S&&(c.style({display:null,top:23+k+"px",left:x+"px"}),h=w.id);for(var E=0;E<w.inputLinks.length;E++){var R=_(O=w.inputLinks[E],s,t,o,0===E,E,w.inputLinks.length).node(),L=t[m-1],N=L[L.length-1];if(null==p&&b===S-1&&O.source.id===N.id&&(O.source.id!==h||l<=5)&&O.dest.id!==h&&L.length>=S){var D=R.getPointAtLength(.7*R.getTotalLength());d.style({display:null,top:D.y+5+"px",left:D.x+3+"px"}),p=O.dest.id}}}}f=i+I/2;var $=t[l-1][0],T=r(0)+I/2;s[$.id]={cx:f,cy:T};for(b=0;b<$.inputLinks.length;b++){var O;_(O=$.inputLinks[b],s,t,o,0===b,b,$.inputLinks.length)}e.attr("height",v);var M=Math.max(C(c),C(d),C(d3.select("#network")));d3.select(".column.features").style("height",M+"px")}function C(t){var e=t.node();return e.offsetHeight+e.offsetTop}function H(t,e){var a=d3.select("#network").append("div").classed("plus-minus-neurons",!0).style("left",t-10+"px"),n=e-1,i=a.append("div").attr("class","ui-numNodes"+e);i.append("button").attr("class","mdl-button mdl-js-button mdl-button--icon").on("click",function(){8<=E.networkShape[n]||(E.networkShape[n]++,K=!0,W())}).append("i").attr("class","material-icons").text("add"),i.append("button").attr("class","mdl-button mdl-js-button mdl-button--icon").on("click",function(){E.networkShape[n]<=1||(E.networkShape[n]--,K=!0,W())}).append("i").attr("class","material-icons").text("remove");var r=1<E.networkShape[n]?"s":"";a.append("div").text(E.networkShape[n]+" neuron"+r)}function Y(e,a,n){var i=d3.select("#hovercard");if(null==e)return i.style("display","none"),void d3.select("#svg").on("click",null);d3.select("#svg").on("click",function(){i.select(".value").style("display","none");var t=i.select("input");t.style("display",null),t.on("input",function(){null!=this.value&&""!==this.value&&(e==k.WEIGHT?a.weight=+this.value:a.bias=+this.value,F())}),t.on("keypress",function(){13==d3.event.keyCode&&Y(e,a,n)}),t.node().focus()});var t=e==k.WEIGHT?a.weight:a.bias,r=e==k.WEIGHT?"Weight":"Bias";i.style({left:n[0]+20+"px",top:n[1]+"px",display:"block"}),i.select(".type").text(r),i.select(".value").style("display",null).text(t.toPrecision(2)),i.select("input").property("value",t.toPrecision(2)).style("display","none")}function _(t,e,a,n,i,r,s){var o=n.insert("path",":first-child"),l=e[t.source.id],u=e[t.dest.id],c={source:{y:l.cx+I/2+2,x:l.cy},target:{y:u.cx-I/2,x:u.cy+(r-(s-1)/2)/s*12}},d=d3.svg.diagonal().projection(function(t){return[t.y,t.x]});return o.attr({"marker-start":"url(#markerArrow)",class:"link",id:"link"+t.source.id+"-"+t.dest.id,d:d(c,0)}),n.append("path").attr("d",d(c,0)).attr("class","link-hover").on("mouseenter",function(){Y(k.WEIGHT,t,d3.mouse(this))}).on("mouseleave",function(){Y(null)}),o}function G(t,e){if(e)for(var a in R={},b.forEachNode(t,!0,function(t){R[t.id]=new Array(A)}),z)R[a]=new Array(A);var n=d3.scale.linear().domain([0,A-1]).range(N),i=d3.scale.linear().domain([A-1,0]).range(N),r=0,s=0;for(r=0;r<A;r++){if(e)for(var a in b.forEachNode(t,!0,function(t){R[t.id][r]=new Array(A)}),z)R[a][r]=new Array(A);for(s=0;s<A;s++){var o=n(r),l=i(s),u=q(o,l);if(b.forwardProp(t,u),b.forEachNode(t,!0,function(t){R[t.id][r][s]=t.output}),e)for(var a in z)R[a][r][s]=z[a].f(o,l)}}}function U(t,e){for(var a=0,n=0;n<e.length;n++){var i=e[n],r=q(i.x,i.y),s=b.forwardProp(t,r);a+=b.Errors.SQUARE.error(s,i.label)}return a/e.length}function F(t){var e;void 0===t&&(t=!1),function(t,e){for(var a=1;a<t.length;a++)for(var n=t[a],i=0;i<n.length;i++)for(var r=n[i],s=0;s<r.inputLinks.length;s++){var o=r.inputLinks[s];e.select("#link"+o.source.id+"-"+o.dest.id).style({"stroke-dashoffset":-v/3,"stroke-width":f(Math.abs(o.weight)),stroke:g(o.weight)}).datum(o)}}($,d3.select("g.core")),e=$,b.forEachNode(e,!0,function(t){d3.select("rect#bias-"+t.id).style("fill",g(t.bias))}),G($,t);var a=null!=L?L:b.getOutputNode($).id;function n(t){return t.toFixed(3)}D.updateBackground(R[a],E.discretize),d3.select("#network").selectAll("div.canvas").each(function(t){t.heatmap.updateBackground(w.reduceMatrix(R[t.id],10),E.discretize)}),d3.select("#loss-train").text(n(x)),d3.select("#loss-test").text(n(T)),d3.select("#iter-number").text(("000000"+v).slice(-"000000".length).replace(/\B(?=(\d{3})+(?!\d))/g,",")),M.addDataPoint([x,T])}function q(t,e){var a=[];for(var n in z)E[n]&&a.push(z[n].f(t,e));return a}function X(){v++,m.forEach(function(t,e){var a=q(t.x,t.y);b.forwardProp($,a),b.backProp($,t.label,b.Errors.SQUARE),(e+1)%E.batchSize==0&&b.updateWeights($,E.learningRate,E.regularizationRate)}),x=U($,m),T=U($,y),F()}function W(t){if(void 0===t&&(t=!1),M.reset(),E.serialize(),t||Q(),O.pause(),d3.select("#num-layers").text(E.numHiddenLayers),"ja"==r.currentLang())0==E.numHiddenLayers||10<=E.numHiddenLayers?d3.select("#layers-label").text("個の隠し層"):d3.select("#layers-label").text("つの隠し層");else{var e=1!==E.numHiddenLayers?"s":"";d3.select("#layers-label").text("Hidden layer"+e)}var a=[q(v=0,0).length].concat(E.networkShape).concat([1]),n=E.problem==o.Problem.REGRESSION?b.Activations.LINEAR:b.Activations.TANH;$=b.buildNetwork(a,E.activation,n,E.regularization,function(){var t=[];for(var e in z)E[e]&&t.push(e);return t}(),E.initZero),x=U($,m),T=U($,y),B($),F(!0)}function j(){function t(t,e){t.setAttribute("width",100),t.setAttribute("height",100);var a=t.getContext("2d");e(200,0).forEach(function(t){a.fillStyle=g(t.label),a.fillRect(100*(t.x+6)/12,100*(t.y+6)/12,4,4)}),d3.select(t.parentNode).style("display",null)}if(d3.selectAll(".dataset").style("display","none"),E.problem==o.Problem.CLASSIFICATION)for(var e in o.datasets){t(document.querySelector("canvas[data-dataset="+e+"]"),o.datasets[e])}if(E.problem==o.Problem.REGRESSION)for(var a in o.regDatasets){t(document.querySelector("canvas[data-regDataset="+a+"]"),o.regDatasets[a])}}function V(t){void 0===t&&(t=!1),t||(E.seed=Math.random().toFixed(5),E.serialize(),Q()),Math.seedrandom(E.seed);var e=E.problem==o.Problem.REGRESSION?c:u,a=(E.problem==o.Problem.CLASSIFICATION?E.dataset:E.regDataset)(e,E.noise/100);i.shuffle(a);var n=Math.floor(a.length*E.percTrainData/100);m=a.slice(0,n),y=a.slice(n),D.updatePoints(m),D.updateTestPoints(E.showTestData?y:[])}a.getOutputWeights=function(t){for(var e=[],a=0;a<t.length-1;a++)for(var n=t[a],i=0;i<n.length;i++)for(var r=n[i],s=0;s<r.outputs.length;s++){var o=r.outputs[s];e.push(o.weight)}return e};var J=!0,K=!1;function Q(){if(J){J=!1;var t="index";null!=E.tutorial&&""!=E.tutorial&&(t="/v/tutorials/"+E.tutorial);try{ga("set","page",t),ga("send","pageview",{sessionControl:"start"})}catch(t){}}}function Z(){try{ga("send",{hitType:"event",eventCategory:"Starting Simulation",eventAction:K?"changed":"unchanged",eventLabel:null==E.tutorial?"":E.tutorial})}catch(t){}K=!1}j(),function(){if(null!=E.tutorial&&""!=E.tutorial&&!E.hideText){d3.selectAll("article div.l--body").remove();var n=d3.select("article").append("div").attr("class","l--body");d3.html("tutorials/"+E.tutorial+".html",function(t,e){if(t)throw t;n.node().appendChild(e);var a=n.select("title");a.size()&&(d3.select("header h1").style({"margin-top":"20px","margin-bottom":"20px"}).text(a.text()),document.title=a.text())})}}(),function(){d3.select("#reset-button").on("click",function(){W(),Q(),d3.select("#play-pause-button")}),d3.select("#play-pause-button").on("click",function(){Q(),O.playOrPause()}),O.onPlayPause(function(t){d3.select("#play-pause-button").classed("playing",t)}),d3.select("#next-step-button").on("click",function(){O.pause(),Q(),0==v&&Z(),X()}),d3.select("#data-regen-button").on("click",function(){V(),K=!0});var e=d3.selectAll("canvas[data-dataset]");e.on("click",function(){var t=o.datasets[this.dataset.dataset];t!==E.dataset&&(E.dataset=t,e.classed("selected",!1),d3.select(this).classed("selected",!0),V(),K=!0,W())});var t=o.getKeyFromValue(o.datasets,E.dataset);d3.select("canvas[data-dataset="+t+"]").classed("selected",!0);var a=d3.selectAll("canvas[data-regDataset]");a.on("click",function(){var t=o.regDatasets[this.dataset.regdataset];t!==E.regDataset&&(E.regDataset=t,a.classed("selected",!1),d3.select(this).classed("selected",!0),V(),K=!0,W())});var n=o.getKeyFromValue(o.regDatasets,E.regDataset);d3.select("canvas[data-regDataset="+n+"]").classed("selected",!0),d3.select("#add-layers").on("click",function(){6<=E.numHiddenLayers||(E.networkShape[E.numHiddenLayers]=2,E.numHiddenLayers++,K=!0,W())}),d3.select("#remove-layers").on("click",function(){E.numHiddenLayers<=0||(E.numHiddenLayers--,E.networkShape.splice(E.numHiddenLayers),K=!0,W())}),d3.select("#show-test-data").on("change",function(){E.showTestData=this.checked,E.serialize(),Q(),D.updateTestPoints(E.showTestData?y:[])}).property("checked",E.showTestData),d3.select("#discretize").on("change",function(){E.discretize=this.checked,E.serialize(),Q(),F()}).property("checked",E.discretize),d3.select("#percTrainData").on("input",function(){E.percTrainData=this.value,d3.select("label[for='percTrainData'] .value").text(this.value),V(),K=!0,W()}).property("value",E.percTrainData),d3.select("label[for='percTrainData'] .value").text(E.percTrainData),d3.select("#noise").on("input",function(){E.noise=this.value,d3.select("label[for='noise'] .value").text(this.value),V(),K=!0,W()}).property("value",E.noise),d3.select("label[for='noise'] .value").text(E.noise),d3.select("#batchSize").on("input",function(){E.batchSize=this.value,d3.select("label[for='batchSize'] .value").text(this.value),K=!0,W()}).property("value",E.batchSize),d3.select("label[for='batchSize'] .value").text(E.batchSize),d3.select("#activations").on("change",function(){E.activation=o.activations[this.value],K=!0,W()}).property("value",o.getKeyFromValue(o.activations,E.activation)),d3.select("#learningRate").on("change",function(){E.learningRate=+this.value,E.serialize(),Q(),K=!0}).property("value",E.learningRate),d3.select("#regularizations").on("change",function(){E.regularization=o.regularizations[this.value],K=!0,W()}).property("value",o.getKeyFromValue(o.regularizations,E.regularization)),d3.select("#regularRate").on("change",function(){E.regularizationRate=+this.value,K=!0,W()}).property("value",E.regularizationRate),d3.select("#problem").on("change",function(){E.problem=o.problems[this.value],V(),j(),K=!0,W()}).property("value",o.getKeyFromValue(o.problems,E.problem)),d3.select("#playground-toggler").on("click",function(){O.pause()});var i=d3.scale.linear().domain([-1,1]).range([0,144]),r=d3.svg.axis().scale(i).orient("bottom").tickValues([-1,0,1]).tickFormat(d3.format("d"));d3.select("#colormap g.core").append("g").attr("class","x axis").attr("transform","translate(0,10)").call(r),window.addEventListener("resize",function(){var t=document.querySelector("#main-part").getBoundingClientRect().width;t!==s&&(s=t,B($),F(!0))}),E.hideText&&(d3.select("#article-text").style("display","none"),d3.select("div.more").style("display","none"),d3.select("header").style("display","none"))}(),V(!0),W(!0),function(){var r=E.getHiddenProps();r.forEach(function(t){var e=d3.selectAll(".ui-"+t);0==e.size()&&console.warn("0 html elements found with class .ui-"+t),e.style("display","none")});var s=d3.select(".hide-controls");d.forEach(function(t){var e=t[0],a=t[1],n=s.append("label").attr("class","mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect"),i=n.append("input").attr({type:"checkbox",class:"mdl-checkbox__input"});-1==r.indexOf(a)&&i.attr("checked","true"),i.on("change",function(){E.setHideProperty(a,!this.checked),E.serialize(),Q(),d3.select(".hide-controls-link").attr("href",window.location.href)}),n.append("span").attr("class","mdl-checkbox__label label").text(e)}),d3.select(".hide-controls-link").attr("href",window.location.href)}(),r.init(E.lang)},{"./additionalcontent":1,"./dataset":2,"./heatmap":3,"./linechart":4,"./nn":5,"./state":7}],7:[function(t,e,a){"use strict";var n,i=t("./nn"),r=t("./dataset"),s="_hide";function o(t,e){for(var a in t)if(t[a]===e)return a}function l(t,e){return t.substr(-e.length)===e}function u(t){var e=[];for(var a in t)l(a,s)&&e.push(a);return e}a.activations={relu:i.Activations.RELU,tanh:i.Activations.TANH,sigmoid:i.Activations.SIGMOID,linear:i.Activations.LINEAR},a.regularizations={none:null,L1:i.RegularizationFunction.L1,L2:i.RegularizationFunction.L2},a.datasets={circle:r.classifyCircleData,xor:r.classifyXORData,gauss:r.classifyTwoGaussData,spiral:r.classifySpiralData},a.regDatasets={"reg-plane":r.regressPlane,"reg-gauss":r.regressGaussian},a.getKeyFromValue=o,(n=a.Type||(a.Type={}))[n.STRING=0]="STRING",n[n.NUMBER=1]="NUMBER",n[n.ARRAY_NUMBER=2]="ARRAY_NUMBER",n[n.ARRAY_STRING=3]="ARRAY_STRING",n[n.BOOLEAN=4]="BOOLEAN",n[n.OBJECT=5]="OBJECT";var c,d=a.Type;(c=a.Problem||(a.Problem={}))[c.CLASSIFICATION=0]="CLASSIFICATION",c[c.REGRESSION=1]="REGRESSION";var h=a.Problem;a.problems={classification:h.CLASSIFICATION,regression:h.REGRESSION};var p=(f.deserializeState=function(){for(var i={},t=0,e=window.location.hash.slice(1).split("&");t<e.length;t++){var a=e[t].split("="),n=a[0],r=a[1];i[n]=r}var s=new f;function o(t){return t in i&&null!=i[t]&&""!==i[t].trim()}function l(t){return""===t.trim()?[]:t.split(",")}return f.PROPS.forEach(function(t){var e=t.name,a=t.type,n=t.keyMap;switch(a){case d.OBJECT:if(null==n)throw Error("A key-value map must be provided for state variables of type Object");o(e)&&i[e]in n&&(s[e]=n[i[e]]);break;case d.NUMBER:o(e)&&(s[e]=+i[e]);break;case d.STRING:o(e)&&(s[e]=i[e]);break;case d.BOOLEAN:o(e)&&(s[e]="false"!==i[e]);break;case d.ARRAY_NUMBER:e in i&&(s[e]=l(i[e]).map(Number));break;case d.ARRAY_STRING:e in i&&(s[e]=l(i[e]));break;default:throw Error("Encountered an unknown type for a state variable")}}),u(i).forEach(function(t){s[t]="true"===i[t]}),s.numHiddenLayers=s.networkShape.length,null==s.seed&&(s.seed=Math.random().toFixed(5)),Math.seedrandom(s.seed),s},f.prototype.serialize=function(){var r=this,s=[];f.PROPS.forEach(function(t){var e=t.name,a=t.type,n=t.keyMap,i=r[e];null!=i&&(a===d.OBJECT?i=o(n,i):a!==d.ARRAY_NUMBER&&a!==d.ARRAY_STRING||(i=i.join(",")),s.push(e+"="+i))}),u(this).forEach(function(t){s.push(t+"="+r[t])}),window.location.hash=s.join("&")},f.prototype.getHiddenProps=function(){var t=[];for(var e in this)l(e,s)&&!0===this[e]&&t.push(e.replace(s,""));return t},f.prototype.setHideProperty=function(t,e){this[t+s]=e},f.PROPS=[{name:"activation",type:d.OBJECT,keyMap:a.activations},{name:"regularization",type:d.OBJECT,keyMap:a.regularizations},{name:"batchSize",type:d.NUMBER},{name:"dataset",type:d.OBJECT,keyMap:a.datasets},{name:"regDataset",type:d.OBJECT,keyMap:a.regDatasets},{name:"learningRate",type:d.NUMBER},{name:"regularizationRate",type:d.NUMBER},{name:"noise",type:d.NUMBER},{name:"networkShape",type:d.ARRAY_NUMBER},{name:"seed",type:d.STRING},{name:"showTestData",type:d.BOOLEAN},{name:"discretize",type:d.BOOLEAN},{name:"percTrainData",type:d.NUMBER},{name:"x",type:d.BOOLEAN},{name:"y",type:d.BOOLEAN},{name:"xTimesY",type:d.BOOLEAN},{name:"xSquared",type:d.BOOLEAN},{name:"ySquared",type:d.BOOLEAN},{name:"cosX",type:d.BOOLEAN},{name:"sinX",type:d.BOOLEAN},{name:"cosY",type:d.BOOLEAN},{name:"sinY",type:d.BOOLEAN},{name:"collectStats",type:d.BOOLEAN},{name:"tutorial",type:d.STRING},{name:"problem",type:d.OBJECT,keyMap:a.problems},{name:"initZero",type:d.BOOLEAN},{name:"hideText",type:d.BOOLEAN},{name:"lang",type:d.STRING}],f);function f(){this.learningRate=.03,this.regularizationRate=0,this.showTestData=!1,this.noise=0,this.batchSize=10,this.discretize=!1,this.tutorial=null,this.percTrainData=50,this.activation=i.Activations.TANH,this.regularization=null,this.problem=h.CLASSIFICATION,this.initZero=!1,this.hideText=!1,this.collectStats=!1,this.numHiddenLayers=1,this.hiddenLayerControls=[],this.networkShape=[4,2],this.x=!0,this.y=!0,this.xTimesY=!1,this.xSquared=!1,this.ySquared=!1,this.cosX=!1,this.sinX=!1,this.cosY=!1,this.sinY=!1,this.dataset=r.classifyCircleData,this.regDataset=r.regressPlane,this.lang="ja"}a.State=p},{"./dataset":2,"./nn":5}]},{},[6]);