!function t(e,a,n){function i(s,o){if(!a[s]){if(!e[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(r)return r(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=a[s]={exports:{}};e[s][0].call(c.exports,function(t){var a=e[s][1][t];return i(a?a:t)},c,c.exports,t,e,a,n)}return a[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(t,e,a){"use strict";function n(){return s}function i(t){(!t||"en"!=t&&"ja"!=t)&&(t="en"),s=t,$(function(){var e=($("#playground-content"),$("#lang-selection button"));r(t),e.on("click",function(t){var e=$(this).data("lang");e!=s&&(s=e,r(e))})})}function r(t){if("ja"==t||"en"==t)if("en"==t)$("[data-i18n='toggleplaygroundvisibility']").text("Click this button to toggle playground visible/hidden."),$("[data-i18n='togglecolortheme']").text("You can switch theme color of this website"),$("[data-i18n='headertitle']").html('Tinker With a <b>Neural Network</b> <span class="optional">Right Here </span>in Your Browser.<br>Don’t Worry, You Can’t Break It. We Promise.'),$("[data-i18n='iterations']").text("Iterations"),$("[data-i18n='learnmingrate']").text("Learning rate"),$("[data-i18n='activation']").text("Activation"),$("[data-i18n='sigmoid']").text("Sigmoid"),$("[data-i18n='linear']").text("Linear"),$("[data-i18n='regularization']").text("Regularization"),$("[data-i18n='regularizationrate']").text("Regularization rate"),$("[data-i18n='problemtype']").text("Problem type"),$("[data-i18n='classification']").text("Classification"),$("[data-i18n='regression']").text("Regression"),$("[data-i18n='data']").text("Data"),$("[data-i18n='whichdataset']").text("Which dataset do you want to use?"),$("[data-i18n='circle']").attr("title","Circle"),$("[data-i18n='exclusiveor']").attr("title","Exclusive or"),$("[data-i18n='gaussian']").attr("title","Gaussian"),$("[data-i18n='spiral']").attr("title","Spiral"),$("[data-i18n='plane']").attr("title","Plane"),$("[data-i18n='multigaussian']").attr("title","Multi gaussian"),$("[data-i18n='rationoftrainingdata']").text("Ratio of training to test data:"),$("[data-i18n='noise']").text("Noise:"),$("[data-i18n='batchsize']").text("Batch size:"),$("[data-i18n='regen']").text("Regenerate"),$("[data-i18n='regen']").attr("title","Regenerate data"),$("[data-i18n='features']").text("Features"),$("[data-i18n='whichproperty']").text("Which properties do you want to feed in?"),$("[data-i18n='clickanywheretoedit']").text("Click anywhere to edit."),$("[data-i18n='thumbnaillabel']").html("This is the output from one <b>neuron</b>. Hover to see it larger."),$("[data-i18n='weightslabel']").html("The outputs are mixed with varying <b>weights</b>, shown by the thickness of the lines."),"1"==$("#num-layers").text()&&$("[data-i18n='layerslabel']").text("Hidden layer"),"1"!=$("#num-layers").text()&&$("[data-i18n='layerslabel']").text("Hidden layers"),$("[data-i18n='output']").text("Output"),$("[data-i18n='testloss']").text("Test loss"),$("[data-i18n='trainingloss']").text("Training loss"),$("[data-i18n='colorsshowsdata']").text(" Colors shows data, neuron and weight values."),$("[data-i18n='showtestdata']").text("Show test data"),$("[data-i18n='discretizeoutput']").text("Discretize output");else if("ja"==t){$("[data-i18n='toggleplaygroundvisibility']").text("デモの非表示/表示を切り替えられます。"),$("[data-i18n='togglecolortheme']").text("サイトのテーマカラーを切り替えられます。"),$("[data-i18n='headertitle']").html('<span class="optional">ブラウザ上で</span><b>ニューラルネットワーク</b>のメカニズムを検証してみよう。<br>何も壊れないから心配はいらない。'),$("[data-i18n='iterations']").text("エポック"),$("[data-i18n='learnmingrate']").text("学習率"),$("[data-i18n='activation']").text("活性化関数"),$("[data-i18n='sigmoid']").text("シグモイド関数"),$("[data-i18n='linear']").text("線形関数"),$("[data-i18n='regularization']").text("正則化"),$("[data-i18n='regularizationrate']").text("正則化項"),$("[data-i18n='problemtype']").text("統計モデルの種類"),$("[data-i18n='classification']").text("分類"),$("[data-i18n='regression']").text("回帰"),$("[data-i18n='data']").text("データ"),$("[data-i18n='whichdataset']").text("どのデータセットを使いますか?"),$("[data-i18n='circle']").attr("title","円"),$("[data-i18n='exclusiveor']").attr("title","排他OR"),$("[data-i18n='gaussian']").attr("title","ガウシアン"),$("[data-i18n='spiral']").attr("title","螺旋"),$("[data-i18n='plane']").attr("title","平面"),$("[data-i18n='multigaussian']").attr("title","マルチガウシアン"),$("[data-i18n='rationoftrainingdata']").text("トレーニングデータの割合:"),$("[data-i18n='noise']").text("ノイズ:"),$("[data-i18n='batchsize']").text("バッチサイズ:"),$("[data-i18n='regen']").text("再生成"),$("[data-i18n='regen']").attr("title","データを再生成する"),$("[data-i18n='features']").text("特徴"),$("[data-i18n='whichproperty']").text("入力するデータの特徴を選択してください"),$("[data-i18n='clickanywheretoedit']").text("クリックして値を編集"),$("[data-i18n='thumbnaillabel']").html("この<b>ニューロン</b>の出力です。マウスオーバーすると拡大して見れます。"),$("[data-i18n='weightslabel']").html("ニューロンの出力は<b>重み</b>の影響を受けます。重みは線の太さと色で表されます。");var e=+$("#num-layers").text();0==e||e>=10?$("[data-i18n='layerslabel']").text("個の隠し層"):$("[data-i18n='layerslabel']").text("つの隠し層"),$("[data-i18n='output']").text("出力"),$("[data-i18n='testloss']").text("誤差(テスト)"),$("[data-i18n='trainingloss']").text("誤差(トレーニング)"),$("[data-i18n='colorsshowsdata']").text("データやニューロン、重みの値は色で表現されます。"),$("[data-i18n='showtestdata']").text("テストデータを表示する"),$("[data-i18n='discretizeoutput']").text("出力を離散化する")}}var s="en";a.currentLang=n,a.init=i},{}],2:[function(t,e,a){"use strict";function n(t){for(var e=t.length,a=0,n=0;e>0;)n=Math.floor(Math.random()*e),e--,a=t[e],t[e]=t[n],t[n]=a}function i(t,e){function a(e,a,i){for(var s=0;s<t/2;s++){var o=d(e,r),l=d(a,r);n.push({x:o,y:l,label:i})}}var n=[],i=d3.scale.linear().domain([0,.5]).range([.5,4]),r=i(e);return a(2,2,1),a(-2,-2,-1),n}function r(t,e){for(var a=d3.scale.linear().domain([-10,10]).range([-1,1]),n=[],i=0;i<t;i++){var r=c(-6,6),s=c(-6,6),o=c(-6,6)*e,l=c(-6,6)*e,u=function(t,e){return a(t+e)}(r+o,s+l);n.push({x:r,y:s,label:u})}return n}function s(t,e){for(var a=[],n=d3.scale.linear().domain([0,2]).range([1,0]).clamp(!0),i=[[-4,2.5,1],[0,2.5,-1],[4,2.5,1],[-4,-2.5,-1],[0,-2.5,1],[4,-2.5,-1]],r=0;r<t;r++){var s=c(-6,6),o=c(-6,6),l=c(-6,6)*e,u=c(-6,6)*e,d=function(t,e){var a=0;return i.forEach(function(i){var r=i[0],s=i[1],o=i[2],l=o*n(h({x:t,y:e},{x:r,y:s}));Math.abs(l)>Math.abs(a)&&(a=l)}),a}(s+l,o+u);a.push({x:s,y:o,label:d})}return a}function o(t,e){function a(t,a){for(var r=0;r<i;r++){var s=r/i*5,o=1.75*r/i*2*Math.PI+t,l=s*Math.sin(o)+c(-1,1)*e,u=s*Math.cos(o)+c(-1,1)*e;n.push({x:l,y:u,label:a})}}var n=[],i=t/2;return a(0,1),a(Math.PI,-1),n}function l(t,e){function a(t,e){return h(t,e)<.5*i?1:-1}for(var n=[],i=5,r=0;r<t/2;r++){var s=c(0,.5*i),o=c(0,2*Math.PI),l=s*Math.sin(o),u=s*Math.cos(o),d=c(-i,i)*e,p=c(-i,i)*e,f=a({x:l+d,y:u+p},{x:0,y:0});n.push({x:l,y:u,label:f})}for(var r=0;r<t/2;r++){var s=c(.7*i,i),o=c(0,2*Math.PI),l=s*Math.sin(o),u=s*Math.cos(o),d=c(-i,i)*e,p=c(-i,i)*e,f=a({x:l+d,y:u+p},{x:0,y:0});n.push({x:l,y:u,label:f})}return n}function u(t,e){for(var a=[],n=0;n<t;n++){var i=c(-5,5);i+=i>0?.3:-.3;var r=c(-5,5);r+=r>0?.3:-.3;var s=c(-5,5)*e,o=c(-5,5)*e,l=function(t){return t.x*t.y>=0?1:-1}({x:i+s,y:r+o});a.push({x:i,y:r,label:l})}return a}function c(t,e){return Math.random()*(e-t)+t}function d(t,e){void 0===t&&(t=0),void 0===e&&(e=1);var a,n,i;do{a=2*Math.random()-1,n=2*Math.random()-1,i=a*a+n*n}while(i>1);var r=Math.sqrt(-2*Math.log(i)/i)*a;return t+Math.sqrt(e)*r}function h(t,e){var a=t.x-e.x,n=t.y-e.y;return Math.sqrt(a*a+n*n)}a.shuffle=n,a.classifyTwoGaussData=i,a.regressPlane=r,a.regressGaussian=s,a.classifySpiralData=o,a.classifyCircleData=l,a.classifyXORData=u},{}],3:[function(t,e,a){"use strict";function n(t,e){if(t.length!==t[0].length)throw new Error("The provided matrix must be a square matrix");if(t.length%e!=0)throw new Error("The width/height of the matrix must be divisible by the reduction factor");for(var a=new Array(t.length/e),n=0;n<t.length;n+=e){a[n/e]=new Array(t.length/e);for(var i=0;i<t.length;i+=e){for(var r=0,s=0;s<e;s++)for(var o=0;o<e;o++)r+=t[n+s][i+o];r/=e*e,a[n/e][i/e]=r}}return a}var i=30,r=function(){function t(t,e,a,n,r,s){this.settings={showAxes:!1,noSvg:!1},this.numSamples=e;var o=t,l=s.showAxes?20:0;if(null!=s)for(var u in s)this.settings[u]=s[u];this.xScale=d3.scale.linear().domain(a).range([0,t-2*l]),this.yScale=d3.scale.linear().domain(n).range([o-2*l,0]);var c=d3.scale.linear().domain([0,.5,1]).range(["#f59322","#e8eaeb","#0877bd"]).clamp(!0),d=d3.range(0,1+1e-9,1/i).map(function(t){return c(t)});if(this.color=d3.scale.quantize().domain([-1,1]).range(d),r=r.append("div").style({width:t+"px",height:o+"px",position:"relative",top:"-"+l+"px",left:"-"+l+"px"}),this.canvas=r.append("canvas").attr("width",e).attr("height",e).style("width",t-2*l+"px").style("height",o-2*l+"px").style("position","absolute").style("top",l+"px").style("left",l+"px"),this.settings.noSvg||(this.svg=r.append("svg").attr({width:t,height:o}).style({position:"absolute",left:"0",top:"0"}).append("g").attr("transform","translate("+l+","+l+")"),this.svg.append("g").attr("class","train"),this.svg.append("g").attr("class","test")),this.settings.showAxes){var h=d3.svg.axis().scale(this.xScale).orient("bottom"),p=d3.svg.axis().scale(this.yScale).orient("right");this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+(o-2*l)+")").call(h),this.svg.append("g").attr("class","y axis").attr("transform","translate("+(t-2*l)+",0)").call(p)}}return t.prototype.updateTestPoints=function(t){if(this.settings.noSvg)throw Error("Can't add points since noSvg=true");this.updateCircles(this.svg.select("g.test"),t)},t.prototype.updatePoints=function(t){if(this.settings.noSvg)throw Error("Can't add points since noSvg=true");this.updateCircles(this.svg.select("g.train"),t)},t.prototype.updateBackground=function(t,e){var a=t[0].length,n=t.length;if(a!==this.numSamples||n!==this.numSamples)throw new Error("The provided data matrix must be of size numSamples X numSamples");for(var i=this.canvas.node().getContext("2d"),r=i.createImageData(a,n),s=0,o=-1;s<n;++s)for(var l=0;l<a;++l){var u=t[l][s];e&&(u=u>=0?1:-1);var c=d3.rgb(this.color(u));r.data[++o]=c.r,r.data[++o]=c.g,r.data[++o]=c.b,r.data[++o]=160}i.putImageData(r,0,0)},t.prototype.updateCircles=function(t,e){var a=this,n=this.xScale.domain(),i=this.yScale.domain();e=e.filter(function(t){return t.x>=n[0]&&t.x<=n[1]&&t.y>=i[0]&&t.y<=i[1]});var r=t.selectAll("circle").data(e);r.enter().append("circle").attr("r",3),r.attr({cx:function(t){return a.xScale(t.x)},cy:function(t){return a.yScale(t.y)}}).style("fill",function(t){return a.color(t.label)}),r.exit().remove()},t}();a.HeatMap=r,a.reduceMatrix=n},{}],4:[function(t,e,a){"use strict";var n=function(){function t(t,e){this.data=[],this.minY=Number.MAX_VALUE,this.maxY=Number.MIN_VALUE,this.lineColors=e,this.numLines=e.length;var a=t.node(),n=a.offsetWidth,i=a.offsetHeight,r={top:2,right:0,bottom:2,left:2},s=n-r.left-r.right,o=i-r.top-r.bottom;this.xScale=d3.scale.linear().domain([0,0]).range([0,s]),this.yScale=d3.scale.linear().domain([0,0]).range([o,0]),this.svg=t.append("svg").attr("width",s+r.left+r.right).attr("height",o+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")"),this.paths=new Array(this.numLines);for(var l=0;l<this.numLines;l++)this.paths[l]=this.svg.append("path").attr("class","line").style({fill:"none",stroke:e[l],"stroke-width":"1.5px"})}return t.prototype.reset=function(){this.data=[],this.redraw(),this.minY=Number.MAX_VALUE,this.maxY=Number.MIN_VALUE},t.prototype.addDataPoint=function(t){var e=this;if(t.length!==this.numLines)throw Error("Length of dataPoint must equal number of lines");t.forEach(function(t){e.minY=Math.min(e.minY,t),e.maxY=Math.max(e.maxY,t)}),this.data.push({x:this.data.length+1,y:t}),this.redraw()},t.prototype.redraw=function(){var t=this;this.xScale.domain([1,this.data.length]),this.yScale.domain([this.minY,this.maxY]);for(var e=0;e<this.numLines;e++)this.paths[e].datum(this.data).attr("d",function(e){return d3.svg.line().x(function(e){return t.xScale(e.x)}).y(function(a){return t.yScale(a.y[e])})}(e))},t}();a.AppendingLineChart=n},{}],5:[function(t,e,a){"use strict";function n(t,e,a,n,i,r){for(var s=t.length,o=1,l=[],c=0;c<s;c++){var d=c===s-1,h=0===c,f=[];l.push(f);for(var v=t[c],g=0;g<v;g++){var m=o.toString();h?m=i[g]:o++;var y=new u(m,d?a:e,r);if(f.push(y),c>=1)for(var x=0;x<l[c-1].length;x++){var b=l[c-1][x],w=new p(b,y,n,r);b.outputs.push(w),y.inputLinks.push(w)}}}return l}function i(t,e){var a=t[0];if(e.length!==a.length)throw new Error("The number of inputs must match the number of nodes in the input layer");for(var n=0;n<a.length;n++){var i=a[n];i.output=e[n]}for(var r=1;r<t.length;r++)for(var s=t[r],n=0;n<s.length;n++){var i=s[n];i.updateOutput()}return t[t.length-1][0].output}function r(t,e,a){var n=t[t.length-1][0];n.outputDer=a.der(n.output,e);for(var i=t.length-1;i>=1;i--){for(var r=t[i],s=0;s<r.length;s++){var o=r[s];o.inputDer=o.outputDer*o.activation.der(o.totalInput),o.accInputDer+=o.inputDer,o.numAccumulatedDers++}for(var s=0;s<r.length;s++)for(var o=r[s],l=0;l<o.inputLinks.length;l++){var u=o.inputLinks[l];u.errorDer=o.inputDer*u.source.output,u.accErrorDer+=u.errorDer,u.numAccumulatedDers++}if(1!==i)for(var c=t[i-1],s=0;s<c.length;s++){var o=c[s];o.outputDer=0;for(var l=0;l<o.outputs.length;l++){var d=o.outputs[l];o.outputDer+=d.weight*d.dest.inputDer}}}}function s(t,e,a){for(var n=1;n<t.length;n++)for(var i=t[n],r=0;r<i.length;r++){var s=i[r];s.numAccumulatedDers>0&&(s.bias-=e*s.accInputDer/s.numAccumulatedDers,s.accInputDer=0,s.numAccumulatedDers=0);for(var o=0;o<s.inputLinks.length;o++){var l=s.inputLinks[o],u=l.regularization?l.regularization.der(l.weight):0;l.numAccumulatedDers>0&&(l.weight-=e/l.numAccumulatedDers*(l.accErrorDer+a*u),l.accErrorDer=0,l.numAccumulatedDers=0)}}}function o(t,e,a){for(var n=e?1:0;n<t.length;n++)for(var i=t[n],r=0;r<i.length;r++){var s=i[r];a(s)}}function l(t){return t[t.length-1][0]}var u=function(){function t(t,e,a){this.inputLinks=[],this.bias=.1,this.outputs=[],this.outputDer=0,this.inputDer=0,this.accInputDer=0,this.numAccumulatedDers=0,this.id=t,this.activation=e,a&&(this.bias=0)}return t.prototype.updateOutput=function(){this.totalInput=this.bias;for(var t=0;t<this.inputLinks.length;t++){var e=this.inputLinks[t];this.totalInput+=e.weight*e.source.output}return this.output=this.activation.output(this.totalInput),this.output},t}();a.Node=u;var c=function(){function t(){}return t.SQUARE={error:function(t,e){return.5*Math.pow(t-e,2)},der:function(t,e){return t-e}},t}();a.Errors=c,Math.tanh=Math.tanh||function(t){if(t===1/0)return 1;if(t===-(1/0))return-1;var e=Math.exp(2*t);return(e-1)/(e+1)};var d=function(){function t(){}return t.TANH={output:function(t){return Math.tanh(t)},der:function(e){var a=t.TANH.output(e);return 1-a*a}},t.RELU={output:function(t){return Math.max(0,t)},der:function(t){return t<=0?0:1}},t.SIGMOID={output:function(t){return 1/(1+Math.exp(-t))},der:function(e){var a=t.SIGMOID.output(e);return a*(1-a)}},t.LINEAR={output:function(t){return t},der:function(t){return 1}},t}();a.Activations=d;var h=function(){function t(){}return t.L1={output:function(t){return Math.abs(t)},der:function(t){return t<0?-1:1}},t.L2={output:function(t){return.5*t*t},der:function(t){return t}},t}();a.RegularizationFunction=h;var p=function(){function t(t,e,a,n){this.weight=Math.random()-.5,this.errorDer=0,this.accErrorDer=0,this.numAccumulatedDers=0,this.id=t.id+"-"+e.id,this.source=t,this.dest=e,this.regularization=a,n&&(this.weight=0)}return t}();a.Link=p,a.buildNetwork=n,a.forwardProp=i,a.backProp=r,a.updateWeights=s,a.forEachNode=o,a.getOutputNode=l},{}],6:[function(t,e,a){"use strict";function n(t){return function(){var e=d3.interpolateNumber(window.pageYOffset||document.documentElement.scrollTop,t);return function(t){scrollTo(0,e(t))}}}function i(t){E.forEachNode(t,!0,function(t){d3.select("rect#bias-"+t.id).style("fill",X(t.bias))})}function r(t,e){for(var a=1;a<t.length;a++)for(var n=t[a],i=0;i<n.length;i++)for(var r=n[i],s=0;s<r.inputLinks.length;s++){var o=r.inputLinks[s];e.select("#link"+o.source.id+"-"+o.dest.id).style({"stroke-dashoffset":-W/3,"stroke-width":q(Math.abs(o.weight)),stroke:X(o.weight)}).datum(o)}}function s(t,e,a,n,i,r){var s=t-O/2,o=e-O/2,l=i.append("g").attr({class:"node",id:"node"+a,transform:"translate("+s+","+o+")"});l.append("rect").attr({x:0,y:0,width:O,height:O});var u=Y[a]?"active":"inactive";if(n){var d=null!=B[a].label?B[a].label:a,p=l.append("text").attr({class:"main-label",x:-10,y:O/2,"text-anchor":"end"});if(/[_^]/.test(d)){for(var f=/(.*?)([_^])(.)/g,v=void 0,g=void 0;null!==(v=f.exec(d));){g=f.lastIndex;var m=v[1],y=v[2],b=v[3];m&&p.append("tspan").text(m),p.append("tspan").attr("baseline-shift","_"==y?"sub":"super").style("font-size","9px").text(b)}d.substring(g)&&p.append("tspan").text(d.substring(g))}else p.append("tspan").text(d);l.classed(u,!0)}n||l.append("rect").attr({id:"bias-"+a,x:-M-2,y:O-M+3,width:M,height:M}).on("mouseenter",function(){c(T.BIAS,r,d3.mouse(i.node()))}).on("mouseleave",function(){c(null)});var w=d3.select("#network").insert("div",":first-child").attr({id:"canvas-"+a,class:"canvas"}).style({position:"absolute",left:s+3+"px",top:o+3+"px"}).on("mouseenter",function(){G=a,w.classed("hovered",!0),l.classed("hovered",!0),h(J,!1),F.updateBackground(_[a],Y.discretize)}).on("mouseleave",function(){G=null,w.classed("hovered",!1),l.classed("hovered",!1),h(J,!1),F.updateBackground(_[E.getOutputNode(J).id],Y.discretize)});n&&(w.on("click",function(){Y[a]=!Y[a],at=!0,x()}),w.style("cursor","pointer")),n&&w.classed(u,!0);var k=new R.HeatMap(O,P/10,U,U,w,{noSvg:!0});w.datum({heatmap:k,id:a})}function o(t){var e=d3.select("#svg");e.select("g.core").remove(),d3.select("#network").selectAll("div.canvas").remove(),d3.select("#network").selectAll("div.plus-minus-neurons").remove();var a=d3.select(".column.output").node(),n=d3.select(".column.features").node(),i=a.offsetLeft-n.offsetLeft;e.attr("width",i);var r={},o=e.append("g").classed("core",!0).attr("transform","translate(3,3)"),c=t.length,h=d3.scale.ordinal().domain(d3.range(1,c-1)).rangePoints([118,i-O],.7),p=function(t){return t*(O+25)},f=d3.select(".callout.thumbnail").style("display","none"),v=d3.select(".callout.weights").style("display","none"),g=null,m=null,y=O/2+50,x=Object.keys(B),b=p(x.length);x.forEach(function(t,e){var a=p(e)+O/2;r[t]={cx:y,cy:a},s(y,a,t,!0,o)});for(var w=1;w<c-1;w++){var k=t[w].length,S=h(w)+O/2;b=Math.max(b,p(k)),u(h(w),w);for(var A=0;A<k;A++){var E=t[w][A],R=p(A)+O/2;r[E.id]={cx:S,cy:R},s(S,R,E.id,!1,o,E);var L=t[w].length,N=t[w+1].length;null==g&&A===L-1&&N<=L&&(f.style({display:null,top:23+R+"px",left:S+"px"}),g=E.id);for(var D=0;D<E.inputLinks.length;D++){var $=E.inputLinks[D],T=d($,r,t,o,0===D,D,E.inputLinks.length).node(),M=t[w-1],I=M[M.length-1];if(null==m&&A===L-1&&$.source.id===I.id&&($.source.id!==g||c<=5)&&$.dest.id!==g&&M.length>=L){var z=T.getPointAtLength(.7*T.getTotalLength());v.style({display:null,top:z.y+5+"px",left:z.x+3+"px"}),m=$.dest.id}}}}y=i+O/2;var P=t[c-1][0],C=p(0)+O/2;r[P.id]={cx:y,cy:C};for(var A=0;A<P.inputLinks.length;A++){var $=P.inputLinks[A];d($,r,t,o,0===A,A,P.inputLinks.length)}e.attr("height",b);var H=Math.max(l(f),l(v),l(d3.select("#network")));d3.select(".column.features").style("height",H+"px")}function l(t){var e=t.node();return e.offsetHeight+e.offsetTop}function u(t,e){var a=d3.select("#network").append("div").classed("plus-minus-neurons",!0).style("left",t-10+"px"),n=e-1,i=a.append("div").attr("class","ui-numNodes"+e);i.append("button").attr("class","mdl-button mdl-js-button mdl-button--icon").on("click",function(){Y.networkShape[n]>=8||(Y.networkShape[n]++,at=!0,x())}).append("i").attr("class","material-icons").text("add"),i.append("button").attr("class","mdl-button mdl-js-button mdl-button--icon").on("click",function(){Y.networkShape[n]<=1||(Y.networkShape[n]--,at=!0,x())}).append("i").attr("class","material-icons").text("remove");var r=Y.networkShape[n]>1?"s":"";a.append("div").text(Y.networkShape[n]+" neuron"+r)}function c(t,e,a){var n=d3.select("#hovercard");if(null==t)return n.style("display","none"),void d3.select("#svg").on("click",null);d3.select("#svg").on("click",function(){n.select(".value").style("display","none");var i=n.select("input");i.style("display",null),i.on("input",function(){null!=this.value&&""!==this.value&&(t==T.WEIGHT?e.weight=+this.value:e.bias=+this.value,f())}),i.on("keypress",function(){13==d3.event.keyCode&&c(t,e,a)}),i.node().focus()});var i=t==T.WEIGHT?e.weight:e.bias,r=t==T.WEIGHT?"Weight":"Bias";n.style({left:a[0]+20+"px",top:a[1]+"px",display:"block"}),n.select(".type").text(r),n.select(".value").style("display",null).text(i.toPrecision(2)),n.select("input").property("value",i.toPrecision(2)).style("display","none")}function d(t,e,a,n,i,r,s){var o=n.insert("path",":first-child"),l=e[t.source.id],u=e[t.dest.id],d={source:{y:l.cx+O/2+2,x:l.cy},target:{y:u.cx-O/2,x:u.cy+(r-(s-1)/2)/s*12}},h=d3.svg.diagonal().projection(function(t){return[t.y,t.x]});return o.attr({"marker-start":"url(#markerArrow)",class:"link",id:"link"+t.source.id+"-"+t.dest.id,d:h(d,0)}),n.append("path").attr("d",h(d,0)).attr("class","link-hover").on("mouseenter",function(){c(T.WEIGHT,t,d3.mouse(this))}).on("mouseleave",function(){c(null)}),o}function h(t,e){if(e){_={},E.forEachNode(t,!0,function(t){_[t.id]=new Array(P)});for(var a in B)_[a]=new Array(P)}var n=d3.scale.linear().domain([0,P-1]).range(U),i=d3.scale.linear().domain([P-1,0]).range(U),r=0,s=0;for(r=0;r<P;r++){if(e){E.forEachNode(t,!0,function(t){_[t.id][r]=new Array(P)});for(var a in B)_[a][r]=new Array(P)}for(s=0;s<P;s++){var o=n(r),l=i(s),u=g(o,l);if(E.forwardProp(t,u),E.forEachNode(t,!0,function(t){_[t.id][r][s]=t.output}),e)for(var a in B)_[a][r][s]=B[a].f(o,l)}}}function p(t,e){for(var a=0,n=0;n<e.length;n++){var i=e[n],r=g(i.x,i.y),s=E.forwardProp(t,r);a+=E.Errors.SQUARE.error(s,i.label)}return a/e.length}function f(t){function e(t){return t.toFixed(3)}void 0===t&&(t=!1),r(J,d3.select("g.core")),i(J),h(J,t);var a=null!=G?G:E.getOutputNode(J).id;F.updateBackground(_[a],Y.discretize),d3.select("#network").selectAll("div.canvas").each(function(t){t.heatmap.updateBackground(R.reduceMatrix(_[t.id],10),Y.discretize)}),d3.select("#loss-train").text(e(K)),d3.select("#loss-test").text(e(Q)),d3.select("#iter-number").text(function(t){return t.replace(/\B(?=(\d{3})+(?!\d))/g,",")}(function(t){return("000000"+t).slice(-"000000".length)}(W))),tt.addDataPoint([K,Q])}function v(){var t=[];for(var e in B)Y[e]&&t.push(e);return t}function g(t,e){var a=[];for(var n in B)Y[n]&&a.push(B[n].f(t,e));return a}function m(){W++,j.forEach(function(t,e){var a=g(t.x,t.y);E.forwardProp(J,a),E.backProp(J,t.label,E.Errors.SQUARE),(e+1)%Y.batchSize==0&&E.updateWeights(J,Y.learningRate,Y.regularizationRate)}),K=p(J,j),Q=p(J,V),f()}function y(t){for(var e=[],a=0;a<t.length-1;a++)for(var n=t[a],i=0;i<n.length;i++)for(var r=n[i],s=0;s<r.outputs.length;s++){var o=r.outputs[s];e.push(o.weight)}return e}function x(t){if(void 0===t&&(t=!1),tt.reset(),Y.serialize(),t||k(),Z.pause(),d3.select("#num-layers").text(Y.numHiddenLayers),"ja"==$.currentLang())0==Y.numHiddenLayers||Y.numHiddenLayers>=10?d3.select("#layers-label").text("個の隠し層"):d3.select("#layers-label").text("つの隠し層");else{var e=1!==Y.numHiddenLayers?"s":"";d3.select("#layers-label").text("Hidden layer"+e)}W=0;var a=g(0,0).length,n=[a].concat(Y.networkShape).concat([1]),i=Y.problem==L.Problem.REGRESSION?E.Activations.LINEAR:E.Activations.TANH;J=E.buildNetwork(n,Y.activation,i,Y.regularization,v(),Y.initZero),K=p(J,j),Q=p(J,V),o(J),f(!0)}function b(){function t(t,e){t.setAttribute("width",100),t.setAttribute("height",100);var a=t.getContext("2d");e(200,0).forEach(function(t){a.fillStyle=X(t.label),a.fillRect(100*(t.x+6)/12,100*(t.y+6)/12,4,4)}),d3.select(t.parentNode).style("display",null)}if(d3.selectAll(".dataset").style("display","none"),Y.problem==L.Problem.CLASSIFICATION)for(var e in L.datasets){var a=document.querySelector("canvas[data-dataset="+e+"]"),n=L.datasets[e];t(a,n)}if(Y.problem==L.Problem.REGRESSION)for(var i in L.regDatasets){var a=document.querySelector("canvas[data-regDataset="+i+"]"),n=L.regDatasets[i];t(a,n)}}function w(t){void 0===t&&(t=!1),t||(Y.seed=Math.random().toFixed(5),Y.serialize(),k()),Math.seedrandom(Y.seed);var e=Y.problem==L.Problem.REGRESSION?z:I,a=Y.problem==L.Problem.CLASSIFICATION?Y.dataset:Y.regDataset,n=a(e,Y.noise/100);N.shuffle(n);var i=Math.floor(n.length*Y.percTrainData/100);j=n.slice(0,i),V=n.slice(i),F.updatePoints(j),F.updateTestPoints(Y.showTestData?V:[])}function k(){if(et){et=!1;var t="index";null!=Y.tutorial&&""!=Y.tutorial&&(t="/v/tutorials/"+Y.tutorial);try{ga("set","page",t),ga("send","pageview",{sessionControl:"start"})}catch(t){}}}function S(){try{ga("send",{hitType:"event",eventCategory:"Starting Simulation",eventAction:at?"changed":"unchanged",eventLabel:null==Y.tutorial?"":Y.tutorial})}catch(t){}at=!1}var A,E=t("./nn"),R=t("./heatmap"),L=t("./state"),N=t("./dataset"),D=t("./linechart"),$=t("./additionalcontent");d3.select(".more button").on("click",function(){d3.transition().duration(1e3).tween("scroll",n(800))});var T,O=30,M=5,I=500,z=1200,P=100;!function(t){t[t.BIAS=0]="BIAS",t[t.WEIGHT=1]="WEIGHT"}(T||(T={}));var B={x:{f:function(t,e){return t},label:"X_1"},y:{f:function(t,e){return e},label:"X_2"},xSquared:{f:function(t,e){return t*t},label:"X_1^2"},ySquared:{f:function(t,e){return e*e},label:"X_2^2"},xTimesY:{f:function(t,e){return t*e},label:"X_1X_2"},sinX:{f:function(t,e){return Math.sin(t)},label:"sin(X_1)"},sinY:{f:function(t,e){return Math.sin(e)},label:"sin(X_2)"}},C=[["Show test data","showTestData"],["Discretize output","discretize"],["Play button","playButton"],["Step button","stepButton"],["Reset button","resetButton"],["Learning rate","learningRate"],["Activation","activation"],["Regularization","regularization"],["Regularization rate","regularizationRate"],["Problem type","problem"],["Which dataset","dataset"],["Ratio train data","percTrainData"],["Noise level","noise"],["Batch size","batchSize"],["# of hidden layers","numHiddenLayers"]],H=function(){function t(){this.timerIndex=0,this.isPlaying=!1,this.callback=null}return t.prototype.playOrPause=function(){this.isPlaying?(this.isPlaying=!1,this.pause()):(this.isPlaying=!0,0==W&&S(),this.play())},t.prototype.onPlayPause=function(t){this.callback=t},t.prototype.play=function(){this.pause(),this.isPlaying=!0,this.callback&&this.callback(this.isPlaying),this.start(this.timerIndex)},t.prototype.pause=function(){this.timerIndex++,this.isPlaying=!1,this.callback&&this.callback(this.isPlaying)},t.prototype.start=function(t){var e=this;d3.timer(function(){return t<e.timerIndex||(m(),!1)},0)},t}(),Y=L.State.deserializeState();Y.getHiddenProps().forEach(function(t){t in B&&delete B[t]});var _={},G=null,U=[-6,6],F=new R.HeatMap(300,P,U,U,d3.select("#heatmap"),{showAxes:!0}),q=d3.scale.linear().domain([0,5]).range([1,10]).clamp(!0),X=d3.scale.linear().domain([-1,0,1]).range(["#f59322","#e8eaeb","#0877bd"]).clamp(!0),W=0,j=[],V=[],J=null,K=0,Q=0,Z=new H,tt=new D.AppendingLineChart(d3.select("#linechart"),["#777","black"]);a.getOutputWeights=y;var et=!0,at=!1;b(),function(){if(null!=Y.tutorial&&""!=Y.tutorial&&!Y.hideText){d3.selectAll("article div.l--body").remove();var t=d3.select("article").append("div").attr("class","l--body");d3.html("tutorials/"+Y.tutorial+".html",function(e,a){if(e)throw e;t.node().appendChild(a);var n=t.select("title");n.size()&&(d3.select("header h1").style({"margin-top":"20px","margin-bottom":"20px"}).text(n.text()),document.title=n.text())})}}(),function(){d3.select("#reset-button").on("click",function(){x(),k(),d3.select("#play-pause-button")}),d3.select("#play-pause-button").on("click",function(){k(),Z.playOrPause()}),Z.onPlayPause(function(t){d3.select("#play-pause-button").classed("playing",t)}),d3.select("#next-step-button").on("click",function(){Z.pause(),k(),0==W&&S(),m()}),d3.select("#data-regen-button").on("click",function(){w(),at=!0});var t=d3.selectAll("canvas[data-dataset]");t.on("click",function(){var e=L.datasets[this.dataset.dataset];e!==Y.dataset&&(Y.dataset=e,t.classed("selected",!1),d3.select(this).classed("selected",!0),w(),at=!0,x())});var e=L.getKeyFromValue(L.datasets,Y.dataset);d3.select("canvas[data-dataset="+e+"]").classed("selected",!0);var a=d3.selectAll("canvas[data-regDataset]");a.on("click",function(){var t=L.regDatasets[this.dataset.regdataset];t!==Y.regDataset&&(Y.regDataset=t,a.classed("selected",!1),d3.select(this).classed("selected",!0),w(),at=!0,x())});var n=L.getKeyFromValue(L.regDatasets,Y.regDataset);d3.select("canvas[data-regDataset="+n+"]").classed("selected",!0),d3.select("#add-layers").on("click",function(){Y.numHiddenLayers>=6||(Y.networkShape[Y.numHiddenLayers]=2,Y.numHiddenLayers++,at=!0,x())}),d3.select("#remove-layers").on("click",function(){Y.numHiddenLayers<=0||(Y.numHiddenLayers--,Y.networkShape.splice(Y.numHiddenLayers),at=!0,x())}),d3.select("#show-test-data").on("change",function(){Y.showTestData=this.checked,Y.serialize(),k(),F.updateTestPoints(Y.showTestData?V:[])}).property("checked",Y.showTestData),d3.select("#discretize").on("change",function(){Y.discretize=this.checked,Y.serialize(),k(),f()}).property("checked",Y.discretize),d3.select("#percTrainData").on("input",function(){Y.percTrainData=this.value,d3.select("label[for='percTrainData'] .value").text(this.value),w(),at=!0,x()}).property("value",Y.percTrainData),d3.select("label[for='percTrainData'] .value").text(Y.percTrainData),d3.select("#noise").on("input",function(){Y.noise=this.value,d3.select("label[for='noise'] .value").text(this.value),w(),at=!0,x()}).property("value",Y.noise),d3.select("label[for='noise'] .value").text(Y.noise),d3.select("#batchSize").on("input",function(){Y.batchSize=this.value,d3.select("label[for='batchSize'] .value").text(this.value),at=!0,x()}).property("value",Y.batchSize),d3.select("label[for='batchSize'] .value").text(Y.batchSize),d3.select("#activations").on("change",function(){Y.activation=L.activations[this.value],at=!0,x()}).property("value",L.getKeyFromValue(L.activations,Y.activation)),d3.select("#learningRate").on("change",function(){Y.learningRate=+this.value,Y.serialize(),k(),at=!0}).property("value",Y.learningRate),d3.select("#regularizations").on("change",function(){Y.regularization=L.regularizations[this.value],at=!0,x()}).property("value",L.getKeyFromValue(L.regularizations,Y.regularization)),d3.select("#regularRate").on("change",function(){Y.regularizationRate=+this.value,at=!0,x()}).property("value",Y.regularizationRate),d3.select("#problem").on("change",function(){Y.problem=L.problems[this.value],w(),b(),at=!0,x()}).property("value",L.getKeyFromValue(L.problems,Y.problem));var i=(d3.select("#playground-toggler").on("click",function(){Z.pause()}),d3.scale.linear().domain([-1,1]).range([0,144])),r=d3.svg.axis().scale(i).orient("bottom").tickValues([-1,0,1]).tickFormat(d3.format("d"));d3.select("#colormap g.core").append("g").attr("class","x axis").attr("transform","translate(0,10)").call(r),window.addEventListener("resize",function(){var t=document.querySelector("#main-part").getBoundingClientRect().width;t!==A&&(A=t,o(J),f(!0))}),Y.hideText&&(d3.select("#article-text").style("display","none"),d3.select("div.more").style("display","none"),d3.select("header").style("display","none"))}(),w(!0),x(!0),function(){var t=Y.getHiddenProps();t.forEach(function(t){var e=d3.selectAll(".ui-"+t);0==e.size()&&console.warn("0 html elements found with class .ui-"+t),e.style("display","none")});var e=d3.select(".hide-controls");C.forEach(function(a){var n=a[0],i=a[1],r=e.append("label").attr("class","mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect"),s=r.append("input").attr({type:"checkbox",class:"mdl-checkbox__input"});t.indexOf(i)==-1&&s.attr("checked","true"),
s.on("change",function(){Y.setHideProperty(i,!this.checked),Y.serialize(),k(),d3.select(".hide-controls-link").attr("href",window.location.href)}),r.append("span").attr("class","mdl-checkbox__label label").text(n)}),d3.select(".hide-controls-link").attr("href",window.location.href)}(),$.init(Y.lang)},{"./additionalcontent":1,"./dataset":2,"./heatmap":3,"./linechart":4,"./nn":5,"./state":7}],7:[function(t,e,a){"use strict";function n(t,e){for(var a in t)if(t[a]===e)return a}function i(t,e){return t.substr(-e.length)===e}function r(t){var e=[];for(var a in t)i(a,l)&&e.push(a);return e}var s=t("./nn"),o=t("./dataset"),l="_hide";a.activations={relu:s.Activations.RELU,tanh:s.Activations.TANH,sigmoid:s.Activations.SIGMOID,linear:s.Activations.LINEAR},a.regularizations={none:null,L1:s.RegularizationFunction.L1,L2:s.RegularizationFunction.L2},a.datasets={circle:o.classifyCircleData,xor:o.classifyXORData,gauss:o.classifyTwoGaussData,spiral:o.classifySpiralData},a.regDatasets={"reg-plane":o.regressPlane,"reg-gauss":o.regressGaussian},a.getKeyFromValue=n,function(t){t[t.STRING=0]="STRING",t[t.NUMBER=1]="NUMBER",t[t.ARRAY_NUMBER=2]="ARRAY_NUMBER",t[t.ARRAY_STRING=3]="ARRAY_STRING",t[t.BOOLEAN=4]="BOOLEAN",t[t.OBJECT=5]="OBJECT"}(a.Type||(a.Type={}));var u=a.Type;!function(t){t[t.CLASSIFICATION=0]="CLASSIFICATION",t[t.REGRESSION=1]="REGRESSION"}(a.Problem||(a.Problem={}));var c=a.Problem;a.problems={classification:c.CLASSIFICATION,regression:c.REGRESSION};var d=function(){function t(){this.learningRate=.03,this.regularizationRate=0,this.showTestData=!1,this.noise=0,this.batchSize=10,this.discretize=!1,this.tutorial=null,this.percTrainData=50,this.activation=s.Activations.TANH,this.regularization=null,this.problem=c.CLASSIFICATION,this.initZero=!1,this.hideText=!1,this.collectStats=!1,this.numHiddenLayers=1,this.hiddenLayerControls=[],this.networkShape=[4,2],this.x=!0,this.y=!0,this.xTimesY=!1,this.xSquared=!1,this.ySquared=!1,this.cosX=!1,this.sinX=!1,this.cosY=!1,this.sinY=!1,this.dataset=o.classifyCircleData,this.regDataset=o.regressPlane,this.lang="ja"}return t.deserializeState=function(){function e(t){return t in n&&null!=n[t]&&""!==n[t].trim()}function a(t){return""===t.trim()?[]:t.split(",")}for(var n={},i=0,s=window.location.hash.slice(1).split("&");i<s.length;i++){var o=s[i],l=o.split("="),c=l[0],d=l[1];n[c]=d}var h=new t;return t.PROPS.forEach(function(t){var i=t.name,r=t.type,s=t.keyMap;switch(r){case u.OBJECT:if(null==s)throw Error("A key-value map must be provided for state variables of type Object");e(i)&&n[i]in s&&(h[i]=s[n[i]]);break;case u.NUMBER:e(i)&&(h[i]=+n[i]);break;case u.STRING:e(i)&&(h[i]=n[i]);break;case u.BOOLEAN:e(i)&&(h[i]="false"!==n[i]);break;case u.ARRAY_NUMBER:i in n&&(h[i]=a(n[i]).map(Number));break;case u.ARRAY_STRING:i in n&&(h[i]=a(n[i]));break;default:throw Error("Encountered an unknown type for a state variable")}}),r(n).forEach(function(t){h[t]="true"===n[t]}),h.numHiddenLayers=h.networkShape.length,null==h.seed&&(h.seed=Math.random().toFixed(5)),Math.seedrandom(h.seed),h},t.prototype.serialize=function(){var e=this,a=[];t.PROPS.forEach(function(t){var i=t.name,r=t.type,s=t.keyMap,o=e[i];null!=o&&(r===u.OBJECT?o=n(s,o):r!==u.ARRAY_NUMBER&&r!==u.ARRAY_STRING||(o=o.join(",")),a.push(i+"="+o))}),r(this).forEach(function(t){a.push(t+"="+e[t])}),window.location.hash=a.join("&")},t.prototype.getHiddenProps=function(){var t=[];for(var e in this)i(e,l)&&this[e]===!0&&t.push(e.replace(l,""));return t},t.prototype.setHideProperty=function(t,e){this[t+l]=e},t.PROPS=[{name:"activation",type:u.OBJECT,keyMap:a.activations},{name:"regularization",type:u.OBJECT,keyMap:a.regularizations},{name:"batchSize",type:u.NUMBER},{name:"dataset",type:u.OBJECT,keyMap:a.datasets},{name:"regDataset",type:u.OBJECT,keyMap:a.regDatasets},{name:"learningRate",type:u.NUMBER},{name:"regularizationRate",type:u.NUMBER},{name:"noise",type:u.NUMBER},{name:"networkShape",type:u.ARRAY_NUMBER},{name:"seed",type:u.STRING},{name:"showTestData",type:u.BOOLEAN},{name:"discretize",type:u.BOOLEAN},{name:"percTrainData",type:u.NUMBER},{name:"x",type:u.BOOLEAN},{name:"y",type:u.BOOLEAN},{name:"xTimesY",type:u.BOOLEAN},{name:"xSquared",type:u.BOOLEAN},{name:"ySquared",type:u.BOOLEAN},{name:"cosX",type:u.BOOLEAN},{name:"sinX",type:u.BOOLEAN},{name:"cosY",type:u.BOOLEAN},{name:"sinY",type:u.BOOLEAN},{name:"collectStats",type:u.BOOLEAN},{name:"tutorial",type:u.STRING},{name:"problem",type:u.OBJECT,keyMap:a.problems},{name:"initZero",type:u.BOOLEAN},{name:"hideText",type:u.BOOLEAN},{name:"lang",type:u.STRING}],t}();a.State=d},{"./dataset":2,"./nn":5}]},{},[6]);